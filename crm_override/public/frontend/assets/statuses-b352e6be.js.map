{"version":3,"file":"statuses-b352e6be.js","sources":["../../../../frontend/src/stores/statuses.js"],"sourcesContent":["import IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport { capture } from '@/telemetry'\nimport { parseColor } from '@/utils'\nimport { defineStore } from 'pinia'\nimport { createListResource } from 'frappe-ui'\nimport { reactive, h } from 'vue'\n\nexport const statusesStore = defineStore('crm-statuses', () => {\n  let leadStatusesByName = reactive({})\n  let dealStatusesByName = reactive({})\n  let communicationStatusesByName = reactive({})\n\n  const leadStatuses = createListResource({\n    doctype: 'CRM Lead Status',\n    fields: ['name', 'color', 'position'],\n    orderBy: 'position asc',\n    cache: 'lead-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        status.color = parseColor(status.color)\n        leadStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  const dealStatuses = createListResource({\n    doctype: 'CRM Deal Status',\n    fields: ['name', 'color', 'position', 'type'],\n    orderBy: 'position asc',\n    cache: 'deal-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        status.color = parseColor(status.color)\n        dealStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  const communicationStatuses = createListResource({\n    doctype: 'CRM Communication Status',\n    fields: ['name'],\n    cache: 'communication-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        communicationStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  function getLeadStatus(name) {\n    if (!name) {\n      name = leadStatuses.data[0].name\n    }\n    return leadStatusesByName[name]\n  }\n\n  function getDealStatus(name) {\n    if (!name) {\n      name = dealStatuses.data[0].name\n    }\n    return dealStatusesByName[name]\n  }\n\n  function getCommunicationStatus(name) {\n    if (!name) {\n      name = communicationStatuses.data[0].name\n    }\n    return communicationStatuses[name]\n  }\n\n  function statusOptions(doctype, statuses = [], triggerStatusChange = null) {\n    let statusesByName =\n      doctype == 'deal' ? dealStatusesByName : leadStatusesByName\n\n    if (statuses?.length) {\n      statusesByName = statuses.reduce((acc, status) => {\n        acc[status] = statusesByName[status]\n        return acc\n      }, {})\n    }\n\n    let options = []\n    for (const status in statusesByName) {\n      options.push({\n        label: statusesByName[status]?.name,\n        value: statusesByName[status]?.name,\n        icon: () => h(IndicatorIcon, { class: statusesByName[status]?.color }),\n        onClick: async () => {\n          await triggerStatusChange?.(statusesByName[status]?.name)\n          capture('status_changed', { doctype, status })\n        },\n      })\n    }\n    return options\n  }\n\n  return {\n    leadStatuses,\n    dealStatuses,\n    communicationStatuses,\n    getLeadStatus,\n    getDealStatus,\n    getCommunicationStatus,\n    statusOptions,\n  }\n})\n"],"names":["statusesStore","defineStore","leadStatusesByName","reactive","dealStatusesByName","communicationStatusesByName","leadStatuses","createListResource","statuses","status","parseColor","dealStatuses","communicationStatuses","getLeadStatus","name","getDealStatus","getCommunicationStatus","statusOptions","doctype","triggerStatusChange","statusesByName","acc","options","_a","_b","h","IndicatorIcon","capture"],"mappings":"gKAOY,MAACA,EAAgBC,EAAY,eAAgB,IAAM,CAC7D,IAAIC,EAAqBC,EAAS,EAAE,EAChCC,EAAqBD,EAAS,EAAE,EAChCE,EAA8BF,EAAS,EAAE,EAE7C,MAAMG,EAAeC,EAAmB,CACtC,QAAS,kBACT,OAAQ,CAAC,OAAQ,QAAS,UAAU,EACpC,QAAS,eACT,MAAO,gBACP,YAAa,CAAE,EACf,KAAM,GACN,UAAUC,EAAU,CAClB,QAASC,KAAUD,EACjBC,EAAO,MAAQC,EAAWD,EAAO,KAAK,EACtCP,EAAmBO,EAAO,IAAI,EAAIA,EAEpC,OAAOD,CACR,CACL,CAAG,EAEKG,EAAeJ,EAAmB,CACtC,QAAS,kBACT,OAAQ,CAAC,OAAQ,QAAS,WAAY,MAAM,EAC5C,QAAS,eACT,MAAO,gBACP,YAAa,CAAE,EACf,KAAM,GACN,UAAUC,EAAU,CAClB,QAASC,KAAUD,EACjBC,EAAO,MAAQC,EAAWD,EAAO,KAAK,EACtCL,EAAmBK,EAAO,IAAI,EAAIA,EAEpC,OAAOD,CACR,CACL,CAAG,EAEKI,EAAwBL,EAAmB,CAC/C,QAAS,2BACT,OAAQ,CAAC,MAAM,EACf,MAAO,yBACP,YAAa,CAAE,EACf,KAAM,GACN,UAAUC,EAAU,CAClB,QAASC,KAAUD,EACjBH,EAA4BI,EAAO,IAAI,EAAIA,EAE7C,OAAOD,CACR,CACL,CAAG,EAED,SAASK,EAAcC,EAAM,CAC3B,OAAKA,IACHA,EAAOR,EAAa,KAAK,CAAC,EAAE,MAEvBJ,EAAmBY,CAAI,CAC/B,CAED,SAASC,EAAcD,EAAM,CAC3B,OAAKA,IACHA,EAAOH,EAAa,KAAK,CAAC,EAAE,MAEvBP,EAAmBU,CAAI,CAC/B,CAED,SAASE,EAAuBF,EAAM,CACpC,OAAKA,IACHA,EAAOF,EAAsB,KAAK,CAAC,EAAE,MAEhCA,EAAsBE,CAAI,CAClC,CAED,SAASG,EAAcC,EAASV,EAAW,CAAA,EAAIW,EAAsB,KAAM,SACzE,IAAIC,EACFF,GAAW,OAASd,EAAqBF,EAEvCM,GAAA,MAAAA,EAAU,SACZY,EAAiBZ,EAAS,OAAO,CAACa,EAAKZ,KACrCY,EAAIZ,CAAM,EAAIW,EAAeX,CAAM,EAC5BY,GACN,EAAE,GAGP,IAAIC,EAAU,CAAE,EAChB,UAAWb,KAAUW,EACnBE,EAAQ,KAAK,CACX,OAAOC,EAAAH,EAAeX,CAAM,IAArB,YAAAc,EAAwB,KAC/B,OAAOC,EAAAJ,EAAeX,CAAM,IAArB,YAAAe,EAAwB,KAC/B,KAAM,IAAA,OAAM,OAAAC,EAAEC,EAAe,CAAE,OAAOH,EAAAH,EAAeX,CAAM,IAArB,YAAAc,EAAwB,MAAO,GACrE,QAAS,SAAY,OACnB,MAAMJ,GAAA,YAAAA,GAAsBI,EAAAH,EAAeX,CAAM,IAArB,YAAAc,EAAwB,OACpDI,EAAQ,iBAAkB,CAAE,QAAAT,EAAS,OAAAT,CAAM,CAAE,CAC9C,CACT,CAAO,EAEH,OAAOa,CACR,CAED,MAAO,CACL,aAAAhB,EACA,aAAAK,EACA,sBAAAC,EACA,cAAAC,EACA,cAAAE,EACA,uBAAAC,EACA,cAAAC,CACD,CACH,CAAC"}