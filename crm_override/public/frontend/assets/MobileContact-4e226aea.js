import{u as de,_ as ue}from"./Icon-84cd6660.js";import{g as _e,S as pe}from"./view-69c9883d.js";import{L as fe}from"./LayoutHeader-3487ee06.js";import{D as ge}from"./DetailsIcon-5874e315.js";import{P as ye}from"./PhoneIcon-ecda9a20.js";import{C as he}from"./CameraIcon-1cffe6d8.js";import{D as ve}from"./DealsIcon-5a4a79e4.js";import{_ as be}from"./DealsListView-36cf9a2d.js";import{b as L,f as we,t as Ce,a as O,D as ke,v as xe}from"./index-7044dffb.js";import{u as De,s as ze,a as Ie,d as Se,e as Me,_ as Pe}from"./modals-0bc101bf.js";import{g as $e}from"./settings-95652367.js";import{g as Be}from"./global-cfeec981.js";import{$ as qe,a0 as Ae,a4 as Fe,y,l as Ne,a3 as Re,X as U,a5 as k,a6 as x,c as h,u as t,g as _,w as p,B as r,b as u,F as Ve,e as P,f as c,d,K as je,a7 as $,t as D,n as H,a8 as K}from"./index-47f22653.js";import{o as Ee}from"./organizations-9f3def06.js";import{s as Te}from"./statuses-b352e6be.js";import{c as X}from"./DragVerticalIcon-415e0cb3.js";import{_ as Le}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-5fda7ab7.js";import{F as Oe}from"./FileUploader-bb9cbac3.js";import"./FadedScrollableDiv-881424bc.js";import"./ArrowUpRightIcon-01dbc17d.js";import"./Link-19e58904.js";import"./ListBulkActions-f0407178.js";import"./DeleteLinkedDocModal-82e5acc7.js";import"./ListView-817be4d7.js";import"./MultipleAvatar-5ebc1733.js";import"./IndicatorIcon-a31cdeff.js";import"./ListFooter-4bfc1f8a.js";import"./description-7674fa11.js";const Ue={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},He={key:1,class:"flex flex-col h-full overflow-hidden"},Ke={class:"flex flex-col items-start justify-start gap-4 p-4"},Xe={class:"flex gap-4 items-center"},Ge={class:"group relative h-14.5 w-14.5"},Je={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Qe={class:"flex flex-col gap-2 truncate"},We={class:"truncate text-lg font-medium text-ink-gray-9"},Ye={key:0},Ze={class:"flex items-center gap-1.5"},ea={key:0},aa={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ta={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},oa={class:"flex flex-col items-center justify-center space-y-3"},Ba={__name:"MobileContact",props:{contactId:{type:String,required:!0}},setup(G){const{brand:J}=$e(),{$dialog:Q,makeCall:W}=Be(),{getUser:B}=qe(),{getOrganization:q}=Ee(),{getDealStatus:Y}=Te(),{doctypeMeta:Z}=L("Contact"),v=G,b=Ae(),ee=Fe(),{document:a,permissions:ae}=De("Contact",v.contactId),te=y(()=>{var e,o;return((o=(e=ae.data)==null?void 0:e.permissions)==null?void 0:o.delete)||!1}),oe=y(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(b.query.view||b.query.viewType){let o=_e(b.query.view,b.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:b.query.viewType},query:{view:b.query.view}}})}return e.push({label:A.value,route:{name:"Contact",params:{contactId:v.contactId}}}),e}),A=y(()=>{var o,i;let e=((o=Z.Contact)==null?void 0:o.title_field)||"name";return((i=a.doc)==null?void 0:i[e])||v.contactId});de(()=>({title:A.value,icon:J.favicon}));function F(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{x.success(__("Contact image updated"))}})}async function se(){Q({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await k("frappe.client.delete",{doctype:"Contact",name:v.contactId}),e(),ee.push({name:"Contacts"})}}]})}const N=Ne(0),ne=[{name:"Details",label:__("Details"),icon:ge},{name:"Deals",label:__("Deals"),icon:Re(ve,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=z.data)==null?void 0:e.length})}],z=U({url:"crm.api.contact.get_linked_deals",cache:["deals",v.contactId],params:{contact:v.contactId},auto:!0}),I=y(()=>!z.data||z.data==[]?[]:z.data.map(e=>re(e))),S=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>y(()=>le(e))});function le(e){return e.map(o=>(o.columns=o.columns.map(i=>(i.fields=i.fields.map(m=>{var w,s,f,C;return m.fieldname==="email_id"?{...m,type:"dropdown",options:((s=(w=a.doc)==null?void 0:w.email_ids)==null?void 0:s.map(l=>({name:l.name,value:l.email_id,selected:l.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>{R("email",l.email_id)},onSave:(n,g)=>{g?V("email",n.value):j("Contact Email",n.name,"email_id",n.value)},onDelete:async(n,g)=>{a.doc.email_ids=a.doc.email_ids.filter(M=>M.name!==n.name),!g&&await E("Contact Email",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.email_ids)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.name==="mobile_no"?{...m,read_only:!1,fieldtype:"dropdown",options:((C=(f=a.doc)==null?void 0:f.phone_nos)==null?void 0:C.map(l=>({name:l.name,value:l.phone,selected:l.phone===a.doc.mobile_no,onClick:()=>{R("mobile_no",l.phone)},onSave:(n,g)=>{g?V("phone",n.value):j("Contact Phone",n.name,"phone",n.value)},onDelete:async(n,g)=>{a.doc.phone_nos=a.doc.phone_nos.filter(M=>M.name!==n.name),!g&&await E("Contact Phone",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.phone_nos)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.name==="address"?{...m,create:(l,n)=>{T(),n()},edit:l=>T(l)}:m}),i)),o))}async function R(e,o){await k("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:o})&&(a.reload(),x.success(___("Contact updated")))}async function V(e,o){if(!o)return;await k("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:o})&&(a.reload(),x.success(__("Contact updated")))}async function j(e,o,i,m){await k("frappe.client.set_value",{doctype:e,name:o,fieldname:i,value:m})&&(a.reload(),x.success(__("Contact updated")))}async function E(e,o){await k("frappe.client.delete",{doctype:e,name:o}),await a.reload(),x.success(__("Contact updated"))}const{getFormattedCurrency:ie}=L("CRM Deal"),ce=y(()=>me);function re(e){var o,i;return{name:e.name,organization:{label:e.organization,logo:(o=q(e.organization))==null?void 0:o.organization_logo},annual_revenue:ie("annual_revenue",e),status:{label:e.status,color:(i=Y(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&B(e.deal_owner).full_name,...e.deal_owner&&B(e.deal_owner)},modified:{label:we(e.modified),timeAgo:__(Ce(e.modified))}}}const me=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function T(e){ze.value=!0,Ie.value={doctype:"Address",address:e}}return(e,o)=>{const i=P("Button"),m=P("ErrorMessage"),w=P("Badge");return c(),h(Ve,null,[t(a).doc?(c(),_(fe,{key:0},{default:p(()=>[d("header",Ue,[u(t(Le),{items:oe.value},{prefix:p(({item:s})=>[s.icon?(c(),_(ue,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])])]),_:1})):r("",!0),t(a).doc?(c(),h("div",He,[u(t(Oe),{onSuccess:F,validateFile:t(xe)},{default:p(({openFileSelector:s,error:f})=>{var C;return[d("div",Ke,[d("div",Xe,[d("div",Ge,[u(t(O),{size:"3xl",class:"h-14.5 w-14.5",label:t(a).doc.full_name,image:t(a).doc.image},null,8,["label","image"]),(c(),_($(t(a).doc.image?t(ke):"div"),je(t(a).doc.image?{options:[{icon:"upload",label:t(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>F("")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[d("div",Je,[u(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),d("div",Qe,[d("div",We,[t(a).doc.salutation?(c(),h("span",Ye,D(t(a).doc.salutation+". "),1)):r("",!0),d("span",null,D(t(a).doc.full_name),1)]),d("div",Ze,[t(X)&&t(a).doc.mobile_no?(c(),_(i,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ye,onClick:o[0]||(o[0]=l=>t(X)&&t(W)(t(a).doc.mobile_no))},null,8,["label"])):r("",!0),te.value?(c(),_(i,{key:1,label:e.__("Delete"),theme:"red",size:"sm","icon-left":"trash-2",onClick:se},null,8,["label"])):r("",!0),t(a).doc.company_name?(c(),_(t(O),{key:2,size:"md",label:t(a).doc.company_name,image:(C=t(q)(t(a).doc.company_name))==null?void 0:C.organization_logo},null,8,["label","image"])):r("",!0)]),u(m,{message:e.__(f)},null,8,["message"])])])])]}),_:1},8,["validateFile"]),u(t(Pe),{as:"div",modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=s=>N.value=s),tabs:ne,class:"overflow-auto"},{default:p(()=>[u(t(Se),{class:"!px-4"},{default:p(({tab:s,selected:f})=>[s.name=="Deals"?(c(),h("button",{key:0,class:H(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":f}])},[s.icon?(c(),_($(s.icon),{key:0,class:"h-5"})):r("",!0),K(" "+D(e.__(s.label))+" ",1),u(w,{class:H(["group-hover:bg-surface-gray-7",[f?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:p(()=>[K(D(s.count),1)]),_:2},1032,["class"])],2)):r("",!0)]),_:1}),u(t(Me),null,{default:p(({tab:s})=>[s.name=="Details"?(c(),h("div",ea,[t(S).data?(c(),h("div",aa,[u(pe,{sections:t(S).data,doctype:"Contact",docname:t(a).doc.name,onReload:t(S).reload},null,8,["sections","docname","onReload"])])):r("",!0)])):s.label==="Deals"&&I.value.length?(c(),_(be,{key:1,class:"mt-4",rows:I.value,columns:ce.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),s.label==="Deals"&&!I.value.length?(c(),h("div",ta,[d("div",oa,[(c(),_($(s.icon),{class:"!h-10 !w-10"})),d("div",null,D(e.__("No {0} Found",[e.__(s.label)])),1)])])):r("",!0)]),_:1})]),_:1},8,["modelValue"])])):r("",!0)],64)}}};export{Ba as default};
//# sourceMappingURL=MobileContact-4e226aea.js.map
