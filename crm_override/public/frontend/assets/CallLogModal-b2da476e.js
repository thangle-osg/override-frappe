import{i as oe,E as ne}from"./DragVerticalIcon-415e0cb3.js";import{A as ue}from"./ArrowUpRightIcon-01dbc17d.js";import{_ as G,f as n,c as d,d as o,a4 as de,O as P,l as k,y as se,a3 as X,aA as Q,z as me,e as j,b as p,w,t as D,u as g,g as x,B as h,F as J,r as ie,a7 as _e,a8 as pe,Y as ve,n as Z,a5 as q,G as re,N as ge,$ as fe,X as Y,ab as Ce,a as ye,aE as he,aU as be,K as ke}from"./index-47f22653.js";import{C as Le}from"./ContactsIcon-19e43cad.js";import{L as Me}from"./LeadsIcon-769e73dd.js";import{D as xe}from"./DealsIcon-5a4a79e4.js";import{C as we}from"./CalendarIcon-810a0d26.js";import{N as W,_ as De}from"./NoteModal-89d49e2b.js";import{T as ee}from"./TaskIcon-ffda7412.js";import{T as $e}from"./TaskModal-f40440e4.js";import{_ as ae}from"./FadedScrollableDiv-881424bc.js";import{b as Ie,f as le,t as Ve,D as Te,a as te,g as Ee}from"./index-7044dffb.js";import{u as ce,c as Ne,q as Be}from"./modals-0bc101bf.js";import{F as Re}from"./FieldLayout-59ef2509.js";const Fe={},Ae={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Oe(i,l){return n(),d("svg",Ae,[...l[0]||(l[0]=[o("g",{"clip-path":"url(#clip0_4750_5685)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.4375 6C10.4375 8.45076 8.45076 10.4375 6 10.4375C3.54924 10.4375 1.5625 8.45076 1.5625 6C1.5625 3.54924 3.54924 1.5625 6 1.5625C8.45076 1.5625 10.4375 3.54924 10.4375 6ZM11.4375 6C11.4375 9.00305 9.00305 11.4375 6 11.4375C2.99695 11.4375 0.5625 9.00305 0.5625 6C0.5625 2.99695 2.99695 0.5625 6 0.5625C9.00305 0.5625 11.4375 2.99695 11.4375 6ZM9.00005 5.50004C9.27619 5.50004 9.50004 5.72391 9.50004 6.00005C9.50004 6.27619 9.27618 6.50004 9.00003 6.50004L6.25001 6.5C5.8358 6.49999 5.50003 6.16421 5.50002 5.75L5.5 3C5.5 2.72386 5.72385 2.5 6 2.5C6.27614 2.5 6.5 2.72385 6.5 3L6.50002 5.5L9.00005 5.50004Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_4750_5685"},[o("rect",{width:"12",height:"12",fill:"white"})])],-1)])])}const Pe=G(Fe,[["render",Oe]]),je={},He={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Se(i,l){return n(),d("svg",He,[...l[0]||(l[0]=[o("g",{"clip-path":"url(#clip0_3668_69185)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_3668_69185"},[o("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const Ue=G(je,[["render",Se]]),{getFormattedPercent:ze,getFormattedFloat:Qe,getFormattedCurrency:Ze}=Ie("CRM Call Log");function qe(i,l,C=[]){var m,v,_,L,b;let f=l.type==="Incoming";if(i==="duration")return{label:l._duration,icon:"clock"};if(i==="caller")return{label:(m=l._caller)==null?void 0:m.label,image:(v=l._caller)==null?void 0:v.image};if(i==="receiver")return{label:(_=l._receiver)==null?void 0:_.label,image:(L=l._receiver)==null?void 0:L.image};if(i==="type")return{label:l.type,icon:f?"phone-incoming":"phone-outgoing"};if(i==="status")return{label:Je[l.status],color:Ge[l.status]};if(["modified","creation"].includes(i))return{label:le(l[i]),timeAgo:__(Ve(l[i]))};let c=(b=C==null?void 0:C.find(M=>(M.key||M.value)==i))==null?void 0:b.type;return c&&["Date","Datetime"].includes(c)?le(l[i],"",!0,c=="Datetime"):c&&c=="Currency"?Ze(i,l):c&&c=="Float"?Qe(i,l):c&&c=="Percent"?ze(i,l):l[i]}const Je={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Canceled:"Canceled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},Ge={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Canceled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"};const Ke={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Xe={class:"mb-5 flex items-center justify-between"},Ye={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},We={class:"flex items-center gap-1"},ea={class:"flex flex-col gap-3.5"},aa={class:"grid size-7 place-content-center"},la={class:"flex min-h-7 w-full items-center gap-2"},ta={key:0,class:"flex items-center gap-1"},oa={class:"ml-1 flex flex-col gap-1"},na={class:"ml-1 flex flex-col gap-1"},sa={key:2,class:"w-full"},ia=["src"],ra=["innerHTML"],ca=["innerHTML"],ua=["innerHTML"],da=["innerHTML"],ma={key:6},_a={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},pa={__name:"CallLogDetailModal",props:{modelValue:{},modelModifiers:{},callLog:{},callLogModifiers:{},callLogModal:{},callLogModalModifiers:{}},emits:["update:modelValue","update:callLog","update:callLogModal"],setup(i){const l=de(),C=P(i,"modelValue"),f=k(!1),c=k(!1),m=P(i,"callLog"),v=k({title:"",content:""}),_=k({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),L=se(()=>{var s,u,r,$,I,V;if(!((s=m.value)!=null&&s.data))return[];let e=JSON.parse(JSON.stringify((u=m.value)==null?void 0:u.data));for(const y in e)e[y]=qe(y,e);return v.value=((r=e._notes)==null?void 0:r[0])??null,_.value=(($=e._tasks)==null?void 0:$[0])??null,[{icon:X(Q,{name:e.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:e.type.label+" Call"},{icon:Le,name:"receiver",value:{receiver:e.receiver,caller:e.caller}},{icon:e._lead?Me:xe,name:"reference_doc",value:e._lead?"Lead":"Deal",link:()=>{e._lead?l.push({name:"Lead",params:{leadId:e._lead}}):l.push({name:"Deal",params:{dealId:e._deal}})},condition:()=>e._lead||e._deal},{icon:we,name:"creation",value:e.creation.label,tooltip:e.creation.label},{icon:Pe,name:"duration",value:e.duration.label},{icon:Ue,name:"status",value:e.status.label,color:e.status.color},{icon:X(Q,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:e.recording_url},{icon:W,name:"note",value:((I=e._notes)==null?void 0:I[0])??null},{icon:ee,name:"task",value:((V=e._tasks)==null?void 0:V[0])??null}].filter(y=>y.value).filter(y=>y.condition?y.condition():!0)}),b=k({}),M=k({});async function F(){var e,a,s,u;await((s=(a=b.value).triggerOnCreateLead)==null?void 0:s.call(a,(e=m.value)==null?void 0:e.data,M.value,()=>C.value=!1)),q("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:(u=m.value)==null?void 0:u.data,lead_details:M.value}).then(r=>{r&&l.push({name:"Lead",params:{leadId:r}})})}const H=P(i,"callLogModal");function S(){H.value=!0,re(()=>{C.value=!1})}function U(){var e;(e=v.value)!=null&&e.name||(v.value={title:"",content:""}),f.value=!0}function A(){var e;(e=_.value)!=null&&e.name||(_.value={title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),c.value=!0}async function z(e,a=!1){var s,u;v.value=e,a&&e.name&&await q("crm.integrations.api.add_note_to_call_log",{call_sid:(u=(s=m.value)==null?void 0:s.data)==null?void 0:u.id,note:e})}async function O(e,a=!1){var s,u;_.value=e,a&&e.name&&await q("crm.integrations.api.add_task_to_call_log",{call_sid:(u=(s=m.value)==null?void 0:s.data)==null?void 0:u.id,task:e})}return me(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.data)==null?void 0:a.name},e=>{e&&(b.value=ce("CRM Call Log",e))}),(e,a)=>{const s=j("Button"),u=j("Dialog");return n(),d(J,null,[p(u,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=r=>C.value=r)},{body:w(()=>{var r,$,I,V,y,K;return[o("div",Ke,[o("div",Xe,[o("div",null,[o("h3",Ye,D(e.__("Call Details")),1)]),o("div",We,[p(g(Te),{options:[{group:e.__("Options"),hideLabel:!0,items:[{label:(r=v.value)!=null&&r.name?e.__("Edit note"):e.__("Add note"),icon:W,onClick:U},{label:($=_.value)!=null&&$.name?e.__("Edit task"):e.__("Add task"),icon:ee,onClick:A}]}]},{default:w(()=>[p(s,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"]),g(oe)?h("",!0):(n(),x(s,{key:0,variant:"ghost",tooltip:e.__("Edit call log"),icon:ne,class:"w-7",onClick:S},null,8,["tooltip"])),p(s,{icon:"x",variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=t=>C.value=!1)})])]),o("div",ea,[(n(!0),d(J,null,ie(L.value,t=>(n(),d("div",{key:t.name,class:"flex gap-2 text-base text-ink-gray-8"},[o("div",aa,[(n(),x(_e(t.icon)))]),o("div",la,[t.name=="receiver"?(n(),d("div",ta,[p(g(te),{image:t.value.caller.image,label:t.value.caller.label,size:"sm"},null,8,["image","label"]),o("div",oa,D(t.value.caller.label),1),p(g(Q),{name:"arrow-right",class:"mx-1 h-4 w-4 text-ink-gray-5"}),p(g(te),{image:t.value.receiver.image,label:t.value.receiver.label,size:"sm"},null,8,["image","label"]),o("div",na,D(t.value.receiver.label),1)])):t.tooltip?(n(),x(g(ve),{key:1,text:t.tooltip},{default:w(()=>[pe(D(t.value),1)]),_:2},1032,["text"])):t.name=="recording_url"?(n(),d("div",sa,[o("audio",{class:"audio-control w-full",controls:"",src:t.value},null,8,ia)])):t.name=="note"?(n(),d("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:a[1]||(a[1]=()=>f.value=!0)},[p(ae,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:w(()=>{var T,E,N,B,R;return[(T=t.value)!=null&&T.title?(n(),d("div",{key:0,class:Z([(E=t.value)!=null&&E.content?"mb-1 font-bold":""]),innerHTML:(N=t.value)==null?void 0:N.title},null,10,ra)):h("",!0),(B=t.value)!=null&&B.content?(n(),d("div",{key:1,innerHTML:(R=t.value)==null?void 0:R.content},null,8,ca)):h("",!0)]}),_:2},1024)])):t.name=="task"?(n(),d("div",{key:4,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:a[2]||(a[2]=()=>c.value=!0)},[p(ae,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:w(()=>{var T,E,N,B,R;return[(T=t.value)!=null&&T.title?(n(),d("div",{key:0,class:Z([(E=t.value)!=null&&E.description?"mb-1 font-bold":""]),innerHTML:(N=t.value)==null?void 0:N.title},null,10,ua)):h("",!0),(B=t.value)!=null&&B.description?(n(),d("div",{key:1,innerHTML:(R=t.value)==null?void 0:R.description},null,8,da)):h("",!0)]}),_:2},1024)])):(n(),d("div",{key:5,class:Z(t.color?`text-${t.color}-600`:"")},D(t.value),3)),t.link?(n(),d("div",ma,[p(ue,{class:"h-4 w-4 shrink-0 cursor-pointer text-ink-gray-5 hover:text-ink-gray-8",onClick:()=>t.link()},null,8,["onClick"])])):h("",!0)])]))),128))])]),!((V=(I=m.value)==null?void 0:I.data)!=null&&V._lead)&&!((K=(y=m.value)==null?void 0:y.data)!=null&&K._deal)?(n(),d("div",_a,[p(s,{class:"w-full",variant:"solid",label:e.__("Create lead"),onClick:F},null,8,["label"])])):h("",!0)]}),_:1},8,["modelValue"]),p(De,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=r=>f.value=r),note:v.value,onAfter:z},null,8,["modelValue","note"]),p($e,{modelValue:c.value,"onUpdate:modelValue":a[5]||(a[5]=r=>c.value=r),task:_.value,onAfter:O},null,8,["modelValue","task"])],64)}}},Aa=G(pa,[["__scopeId","data-v-1cb12bfd"]]),va={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},ga={class:"flex items-center justify-between mb-5"},fa={class:"flex items-center gap-2"},Ca={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ya={class:"flex items-center gap-1"},ha={key:0},ba={class:"px-4 pt-4 pb-7 sm:px-6"},ka={class:"flex justify-end gap-2"},Oa={__name:"CallLogModal",props:ge({data:{type:Object,default:()=>({})},referenceDoc:{type:Object,default:()=>({})},options:{type:Object,default:{afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){var O;const l=i,{isManager:C}=fe(),f=P(i,"modelValue"),c=k(!1),m=k(null),v=k(!1),{document:_,triggerOnBeforeCreate:L}=ce("CRM Call Log",((O=l.data)==null?void 0:O.name)||""),b=se(()=>{let e=v.value?__("Edit Call Log"):__("New Call Log"),a="xl",s=[{label:v.value?__("Save"):__("Create"),variant:"solid",onClick:()=>v.value?H():S()}];return{title:e,size:a,actions:s}}),M=Y({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Call Log"],params:{doctype:"CRM Call Log",type:"Quick Entry"},auto:!0}),F={onSuccess:e=>{c.value=!1,A(e)},onError:e=>{if(c.value=!1,e.exc_type=="MandatoryError"){const a=e.messages.map(s=>{let u=s.split(": ");return u[u.length-1].trim()}).join(", ");m.value=__("These fields are required: {0}",[a]);return}m.value=e}};async function H(){c.value=!0,await _.save.submit(null,F)}async function S(){Object.assign(_.doc,{doctype:"CRM Call Log",id:Ee(6),telephony_medium:"Manual"}),await(L==null?void 0:L(l.referenceDoc)),await U.submit({doc:_.doc})}const U=Y({url:"frappe.client.insert",onSuccess(e){c.value=!1,e.name&&(Ce("call_log_created"),A(e))},onError(e){F.onError(e)}});function A(e){f.value=!1,l.options.afterInsert&&l.options.afterInsert(e)}ye(()=>{var e,a;v.value=!!((e=l.data)!=null&&e.name),(a=l.data)!=null&&a.name||(_.doc={...l.data})});function z(){Ne.value=!0,Be.value={doctype:"CRM Call Log"},re(()=>f.value=!1)}return(e,a)=>{const s=j("Button"),u=j("Dialog");return n(),x(u,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=r=>f.value=r),options:b.value},{body:w(()=>[o("div",va,[o("div",ga,[o("div",fa,[o("h3",Ca,D(e.__(b.value.title)||e.__("Untitled")),1),g(_).isDirty?(n(),x(g(he),{key:0,label:"Not Saved",theme:"orange"})):h("",!0)]),o("div",ya,[g(C)()&&!g(oe)?(n(),x(s,{key:0,variant:"ghost",tooltip:e.__("Edit fields layout"),icon:ne,class:"w-7",onClick:z},null,8,["tooltip"])):h("",!0),p(s,{variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=r=>f.value=!1),icon:"x"})])]),g(M).data?(n(),d("div",ha,[p(Re,{tabs:g(M).data,data:g(_).doc,doctype:"CRM Call Log"},null,8,["tabs","data"]),p(g(be),{class:"mt-8",message:m.value},null,8,["message"])])):h("",!0)]),o("div",ba,[o("div",ka,[(n(!0),d(J,null,ie(b.value.actions,r=>(n(),x(s,ke({class:"w-full",key:r.label},{ref_for:!0},r,{label:e.__(r.label),loading:c.value}),null,16,["label","loading"]))),128))])])]),_:1},8,["modelValue","options"])}}};export{Aa as C,Pe as D,Oa as _,Ge as a,qe as g,Je as s};
//# sourceMappingURL=CallLogModal-b2da476e.js.map
