{"version":3,"file":"TaskModal-f40440e4.js","sources":["../../../../frontend/src/components/Modals/TaskModal.vue"],"sourcesContent":["<template>\n  <Dialog v-model=\"show\" :options=\"{ size: 'xl' }\">\n    <template #body-title>\n      <div class=\"flex items-center gap-3\">\n        <h3 class=\"text-2xl font-semibold leading-6 text-ink-gray-9\">\n          {{ editMode ? __('Edit Task') : __('Create Task') }}\n        </h3>\n        <Button\n          v-if=\"task?.reference_docname\"\n          size=\"sm\"\n          :label=\"\n            task.reference_doctype == 'CRM Deal'\n              ? __('Open Deal')\n              : __('Open Lead')\n          \"\n          :iconRight=\"ArrowUpRightIcon\"\n          @click=\"redirect()\"\n        />\n      </div>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-4\">\n        <div>\n          <FormControl\n            ref=\"title\"\n            :label=\"__('Title')\"\n            v-model=\"_task.title\"\n            :placeholder=\"__('Call with John Doe')\"\n            required\n          />\n        </div>\n        <div>\n          <div class=\"mb-1.5 text-xs text-ink-gray-5\">\n            {{ __('Description') }}\n          </div>\n          <TextEditor\n            variant=\"outline\"\n            ref=\"description\"\n            editor-class=\"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors\"\n            :bubbleMenu=\"true\"\n            :content=\"_task.description\"\n            @change=\"(val) => (_task.description = val)\"\n            :placeholder=\"\n              __('Took a call with John Doe and discussed the new project.')\n            \"\n          />\n        </div>\n        <div class=\"flex flex-wrap items-center gap-2\">\n          <Dropdown :options=\"taskStatusOptions(updateTaskStatus)\">\n            <Button :label=\"_task.status\">\n              <template #prefix>\n                <TaskStatusIcon :status=\"_task.status\" />\n              </template>\n            </Button>\n          </Dropdown>\n          <Link\n            class=\"form-control\"\n            :value=\"getUser(_task.assigned_to).full_name\"\n            doctype=\"User\"\n            @change=\"(option) => (_task.assigned_to = option)\"\n            :placeholder=\"__('John Doe')\"\n            :filters=\"{\n              name: ['in', users.data.crmUsers?.map((user) => user.name)],\n            }\"\n            :hideMe=\"true\"\n          >\n            <template #prefix>\n              <UserAvatar class=\"mr-2 !h-4 !w-4\" :user=\"_task.assigned_to\" />\n            </template>\n            <template #item-prefix=\"{ option }\">\n              <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"sm\" />\n            </template>\n            <template #item-label=\"{ option }\">\n              <Tooltip :text=\"option.value\">\n                <div class=\"cursor-pointer text-ink-gray-9\">\n                  {{ getUser(option.value).full_name }}\n                </div>\n              </Tooltip>\n            </template>\n          </Link>\n          <div class=\"w-36\">\n            <DateTimePicker\n              class=\"datepicker\"\n              v-model=\"_task.due_date\"\n              :placeholder=\"__('01/04/2024 11:30 PM')\"\n              :formatter=\"(date) => getFormat(date, '', true, true)\"\n              input-class=\"border-none\"\n            />\n          </div>\n          <Dropdown :options=\"taskPriorityOptions(updateTaskPriority)\">\n            <Button :label=\"_task.priority\">\n              <template #prefix>\n                <TaskPriorityIcon :priority=\"_task.priority\" />\n              </template>\n            </Button>\n          </Dropdown>\n        </div>\n        <ErrorMessage class=\"mt-4\" v-if=\"error\" :message=\"__(error)\" />\n      </div>\n    </template>\n    <template #actions>\n      <div class=\"flex justify-end\">\n        <Button\n          :label=\"editMode ? __('Update') : __('Create')\"\n          variant=\"solid\"\n          @click=\"updateTask\"\n        />\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport TaskStatusIcon from '@/components/Icons/TaskStatusIcon.vue'\nimport TaskPriorityIcon from '@/components/Icons/TaskPriorityIcon.vue'\nimport ArrowUpRightIcon from '@/components/Icons/ArrowUpRightIcon.vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport { taskStatusOptions, taskPriorityOptions, getFormat } from '@/utils'\nimport { usersStore } from '@/stores/users'\nimport { capture } from '@/telemetry'\nimport { TextEditor, Dropdown, Tooltip, call, DateTimePicker } from 'frappe-ui'\nimport { useOnboarding } from 'frappe-ui/frappe'\nimport { ref, watch, nextTick, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  task: {\n    type: Object,\n    default: {},\n  },\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  doc: {\n    type: String,\n    default: '',\n  },\n})\n\nconst show = defineModel()\nconst tasks = defineModel('reloadTasks')\n\nconst emit = defineEmits(['updateTask', 'after'])\n\nconst router = useRouter()\nconst { users, getUser } = usersStore()\nconst { updateOnboardingStep } = useOnboarding('frappecrm')\n\nconst error = ref(null)\nconst title = ref(null)\nconst editMode = ref(false)\nconst _task = ref({\n  title: '',\n  description: '',\n  assigned_to: '',\n  due_date: '',\n  status: 'Backlog',\n  priority: 'Low',\n  reference_doctype: props.doctype,\n  reference_docname: null,\n})\n\nfunction updateTaskStatus(status) {\n  _task.value.status = status\n}\n\nfunction updateTaskPriority(priority) {\n  _task.value.priority = priority\n}\n\nfunction redirect() {\n  if (!props.task?.reference_docname) return\n  let name = props.task.reference_doctype == 'CRM Deal' ? 'Deal' : 'Lead'\n  let params = { leadId: props.task.reference_docname }\n  if (name == 'Deal') {\n    params = { dealId: props.task.reference_docname }\n  }\n  router.push({ name: name, params: params })\n}\n\nasync function updateTask() {\n  if (!_task.value.assigned_to) {\n    _task.value.assigned_to = getUser().name\n  }\n  if (_task.value.name) {\n    let d = await call('frappe.client.set_value', {\n      doctype: 'CRM Task',\n      name: _task.value.name,\n      fieldname: _task.value,\n    })\n    if (d.name) {\n      tasks.value?.reload()\n      emit('after', d)\n    }\n  } else {\n    let d = await call(\n      'frappe.client.insert',\n      {\n        doc: {\n          doctype: 'CRM Task',\n          reference_doctype: props.doctype,\n          reference_docname: props.doc || null,\n          ..._task.value,\n        },\n      },\n      {\n        onError: (err) => {\n          if (err.error.exc_type == 'MandatoryError') {\n            error.value = 'Title is mandatory'\n          }\n        },\n      },\n    )\n    if (d.name) {\n      updateOnboardingStep('create_first_task')\n      capture('task_created')\n      tasks.value?.reload()\n      emit('after', d, true)\n    }\n  }\n  show.value = false\n}\n\nfunction render() {\n  editMode.value = false\n  nextTick(() => {\n    title.value?.el?.focus?.()\n    _task.value = { ...props.task }\n    if (_task.value.title) {\n      editMode.value = true\n    }\n  })\n}\n\nonMounted(() => show.value && render())\n\nwatch(show, (value) => {\n  if (!value) return\n  render()\n})\n</script>\n\n<style scoped>\n:deep(.datepicker svg) {\n  width: 0.875rem;\n  height: 0.875rem;\n}\n</style>\n"],"names":["props","__props","show","_useModel","tasks","emit","__emit","router","useRouter","users","getUser","usersStore","updateOnboardingStep","useOnboarding","error","ref","title","editMode","_task","updateTaskStatus","status","updateTaskPriority","priority","redirect","_a","name","params","updateTask","d","call","err","capture","_b","render","nextTick","_c","onMounted","watch","value","_createBlock","_component_Dialog","$event","_createElementVNode","_hoisted_1","_hoisted_2","_toDisplayString","__","_component_Button","ArrowUpRightIcon","_hoisted_3","_createVNode","_component_FormControl","_cache","_hoisted_4","_unref","TextEditor","val","_hoisted_5","Dropdown","taskStatusOptions","TaskStatusIcon","Link","option","user","UserAvatar","_withCtx","Tooltip","_hoisted_6","_hoisted_7","DateTimePicker","date","getFormat","taskPriorityOptions","TaskPriorityIcon","_component_ErrorMessage","_hoisted_8"],"mappings":"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"}