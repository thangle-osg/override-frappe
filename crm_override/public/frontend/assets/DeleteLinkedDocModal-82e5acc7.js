import{l as L,z as Y,y as Q,aS as Z,o as ee,a as te,u as p,f as s,c as f,F as S,r as V,b as k,w as _,d as a,t as y,g,a7 as ne,B as C,A as K,K as X,e as A,a2 as le,n as se,N as oe,O as ae,a4 as ie,X as re,a9 as ce,a8 as de,a5 as H}from"./index-47f22653.js";import{e as ue,f as J,g as me,h as fe,_ as _e,a as ve,b as pe,d as ye}from"./ListView-817be4d7.js";const ke={key:0,class:"mx-3 mt-2 h-full overflow-y-auto sm:mx-5"},ge={class:"my-2 flex items-center gap-2 text-base font-medium text-ink-gray-8"},he={class:"flex items-center gap-1"},we={key:1,class:"text-ink-gray-4"},be={key:2},Ce={__name:"ListRows",props:{rows:{type:Array,required:!0},doctype:{type:String,default:"CRM Lead"}},setup(h){const v=h,w=L(v.rows);Y(()=>v.rows,e=>w.value=e);let i=Q(()=>v.rows.every(e=>e.group&&e.rows&&Array.isArray(e.rows)));const c=Z(`scrollPosition${v.doctype}`,0),o=L(null),r=()=>{o.value&&(c.value=o.value.$el.scrollTop)};return ee(()=>{o.value&&o.value.$el.removeEventListener("scroll",r)}),te(()=>{o.value&&(o.value.$el.addEventListener("scroll",r),o.value.$el.scrollTop=c.value)}),(e,u)=>p(i)?(s(),f("div",ke,[(s(!0),f(S,null,V(w.value,n=>(s(),f("div",{key:n.group},[k(p(ue),{group:n},{default:_(()=>[a("div",ge,[a("div",null,y(e.__(n.label))+" -",1),a("div",he,[n.icon?(s(),g(ne(n.icon),{key:0})):C("",!0),n.group==" "?(s(),f("div",we,y(e.__("Empty")),1)):(s(),f("div",be,y(n.group),1))])])]),_:2},1032,["group"]),k(p(me),{group:n},{default:_(()=>[(s(!0),f(S,null,V(n.rows,d=>(s(),g(p(J),{key:d.name,row:d},{default:_(({idx:$,column:b,item:D})=>[K(e.$slots,"default",X({ref_for:!0},{idx:$,column:b,item:D,row:d}))]),_:2},1032,["row"]))),128))]),_:2},1032,["group"])]))),128))])):(s(),g(p(fe),{key:1,ref_key:"scrollContainer",ref:o,class:"mx-3 sm:mx-5",onScroll:r},{default:_(()=>[(s(!0),f(S,null,V(w.value,n=>(s(),g(p(J),{key:n.name,row:n},{default:_(({idx:d,column:$,item:b})=>[K(e.$slots,"default",X({ref_for:!0},{idx:d,column:$,item:b,row:n}))]),_:2},1032,["row"]))),128))]),_:3},512))}},$e={class:"*:mx-0 *:sm:mx-0"},xe={key:0,class:"truncate text-base flex gap-2 w-full"},De={class:"max-w-[90%] truncate"},Re={key:1,class:"truncate text-base flex gap-2"},Le={__name:"LinkedDocsListView",props:{rows:{type:Array,required:!0},columns:{type:Array,required:!0},linkedDocsResource:{type:Object,required:!0},unlinkLinkedDoc:{type:Function,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},emits:["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],setup(h,{emit:v}){const w=v,i=L(null),c=r=>{let e="",u="",n=!1;switch(r.reference_doctype){case"CRM Lead":e="leads",u=r.reference_docname;break;case"CRM Call Log":e="call-logs",u=`view?open=${r.reference_docname}`;break;case"CRM Task":e="tasks",u=`view?open=${r.reference_docname}`;break;case"Contact":e="contacts",u=r.reference_docname;break;case"CRM Organization":e="organizations",u=r.reference_docname;break;case"CRM Notification":e="crm-notification",u=r.reference_docname,n=!0;break;case"FCRM Note":e="notes",u=`view?open=${r.reference_docname}`;break}let d="/crm";n&&(d="/app"),window.open(`${d}/${e}/${u}`)},o=r=>r.replace(/^(CRM|FCRM)\s*/,"");return(r,e)=>{const u=A("FeatherIcon");return s(),g(p(ye),{class:se(r.$attrs.class),columns:h.columns,rows:h.rows,options:{selectable:!0,showTooltip:!0,resizeColumn:!0},"row-key":"reference_docname","onUpdate:selections":e[1]||(e[1]=n=>w("selectionsChanged",n)),ref_key:"listViewRef",ref:i},{default:_(()=>[k(p(_e),{onColumnWidthUpdated:e[0]||(e[0]=n=>w("columnWidthUpdated"))},{default:_(()=>[(s(!0),f(S,null,V(h.columns,n=>(s(),g(p(ve),{key:n.key,item:n,onColumnWidthUpdated:d=>w("columnWidthUpdated",n)},null,8,["item","onColumnWidthUpdated"]))),128))]),_:1}),a("div",$e,[k(Ce,{rows:h.rows},{default:_(({idx:n,column:d,item:$,row:b})=>[k(p(pe),{item:$,onClick:D=>i.value.toggleRow(b.reference_docname),class:"!w-full"},{default:_(({label:D})=>[d.key==="title"?(s(),f("div",xe,[a("span",De,y(D),1),k(u,{name:"external-link",class:"h-4 w-4 cursor-pointer",onClick:le(t=>c(b),["stop"])},null,8,["onClick"])])):C("",!0),d.key==="reference_doctype"?(s(),f("span",Re,y(o(b.reference_doctype)),1)):C("",!0)]),_:2},1032,["item","onClick"])]),_:1},8,["rows"])])]),_:1},8,["class","columns","rows"])}}},Me={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Se={class:"mb-6 flex items-center justify-between"},Ve={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},Ue={class:"flex items-center gap-1"},Ae={key:0},Fe={class:"text-ink-gray-5 text-base"},qe={key:1,class:"text-ink-gray-5 text-base"},Be={class:"px-4 pb-7 pt-0 sm:px-6"},Ne={class:"flex flex-row-reverse gap-2"},ze={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Te={class:"mb-6 flex items-center justify-between"},We={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},je={class:"flex items-center gap-1"},Ee={class:"text-ink-gray-5 text-base"},Oe={class:"flex justify-end gap-2 mt-6"},Ge={__name:"DeleteLinkedDocModal",props:oe({name:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},reload:{type:Function}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const v=ae(h,"modelValue"),w=ie(),i=h,c=L({selections:[],updateSelections:t=>{c.value.selections=Array.from(t||[])}}),o=L({show:!1,title:""}),r=re({url:"crm.api.doc.get_linked_docs_of_document",params:{doctype:i.doctype,docname:i.docname},auto:!0,validate(t){if(!(t!=null&&t.doctype)||!(t!=null&&t.docname))return!1}}),e=Q(()=>{var t;return((t=r.data)==null?void 0:t.map(l=>({id:l.reference_docname,...l})))||[]}),u=()=>{o.value.show=!1,c.value.updateSelections([])},n=t=>{let l=[];c.value.selections.length>0?Array.from(c.value.selections).forEach(m=>{const M=e.value.find(U=>U.id==m);l.push({doctype:M.reference_doctype,docname:M.reference_docname})}):l=e.value.map(m=>({doctype:m.reference_doctype,docname:m.reference_docname})),H("crm.api.doc.remove_linked_doc_reference",{items:l,remove_contact:i.doctype=="Contact",delete:t.delete}).then(()=>{r.reload(),o.value={show:!1,title:""}})},d=()=>{const t=c.value.selections.length==0?"all":c.value.selections.length;o.value={show:!0,title:__("Delete linked item"),message:__("Are you sure you want to delete {0} linked item(s)?",[t]),delete:!0}},$=()=>{const t=c.value.selections.length==0?"all":c.value.selections.length;o.value={show:!0,title:__("Unlink linked item"),message:__("Are you sure you want to unlink {0} linked item(s)?",[t]),delete:!1}},b=()=>{n({reference_doctype:i.doctype,reference_docname:i.docname,delete:o.value.delete}),c.value.updateSelections([])},D=async()=>{var t;await H("frappe.client.delete",{doctype:i.doctype,name:i.docname}),w.push({name:i.name}),(t=i==null?void 0:i.reload)==null||t.call(i)};return(t,l)=>{const m=A("Button"),M=Le,U=A("Dialog");return s(),g(U,{modelValue:v.value,"onUpdate:modelValue":l[8]||(l[8]=x=>v.value=x),options:{size:"xl"}},ce({_:2},[o.value.show?void 0:{name:"body",fn:_(()=>{var x,F,q,B,N,z,T,W,j,E,O,P,I,G;return[a("div",Me,[a("div",Se,[a("div",null,[a("h3",Ve,y(((x=e.value)==null?void 0:x.length)==0?t.__("Delete"):t.__("Delete or unlink linked documents")),1)]),a("div",Ue,[k(m,{variant:"ghost",icon:"x",onClick:l[0]||(l[0]=R=>v.value=!1)})])]),a("div",null,[((F=e.value)==null?void 0:F.length)>0?(s(),f("div",Ae,[a("span",Fe,y(t.__("Delete or unlink these linked documents before deleting this document")),1),k(M,{class:"mt-4",rows:e.value,columns:[{label:"Document",key:"title",width:"19rem"},{label:"Master",key:"reference_doctype",width:"12rem"}],onSelectionsChanged:l[1]||(l[1]=R=>c.value.updateSelections(R)),linkedDocsResource:p(r),unlinkLinkedDoc:n},null,8,["rows","linkedDocsResource"])])):C("",!0),((q=e.value)==null?void 0:q.length)==0?(s(),f("div",qe,y(t.__("Are you sure you want to delete {0} - {1}?",[i.doctype,i.docname])),1)):C("",!0)])]),a("div",Be,[a("div",Ne,[((B=e.value)==null?void 0:B.length)>0?(s(),g(m,{key:0,label:((z=(N=c.value)==null?void 0:N.selections)==null?void 0:z.length)==0?t.__("Delete all"):t.__("Delete {0} item(s)",[(W=(T=c.value)==null?void 0:T.selections)==null?void 0:W.length]),theme:"red",variant:"solid","icon-left":"trash-2",onClick:l[2]||(l[2]=R=>d())},null,8,["label"])):C("",!0),((j=e.value)==null?void 0:j.length)>0?(s(),g(m,{key:1,label:((O=(E=c.value)==null?void 0:E.selections)==null?void 0:O.length)==0?t.__("Unlink all"):t.__("Unlink {0} item(s)",[(I=(P=c.value)==null?void 0:P.selections)==null?void 0:I.length]),variant:"subtle",theme:"gray","icon-left":"unlock",onClick:l[3]||(l[3]=R=>$())},null,8,["label"])):C("",!0),((G=e.value)==null?void 0:G.length)==0?(s(),g(m,{key:2,variant:"solid","icon-left":"trash-2",label:t.__("Delete"),loading:t.isDealCreating,onClick:l[4]||(l[4]=R=>D()),theme:"red"},null,8,["label","loading"])):C("",!0)])])]}),key:"0"},o.value.show?{name:"body",fn:_(()=>[a("div",ze,[a("div",Te,[a("div",null,[a("h3",We,y(o.value.title),1)]),a("div",je,[k(m,{variant:"ghost",icon:"x",onClick:l[5]||(l[5]=x=>v.value=!1)})])]),a("div",Ee,y(o.value.message),1),a("div",Oe,[k(m,{variant:"ghost",onClick:l[6]||(l[6]=x=>u())},{default:_(()=>[de(y(t.__("Cancel")),1)]),_:1}),k(m,{variant:"solid",label:o.value.title,onClick:l[7]||(l[7]=x=>b()),theme:"red"},null,8,["label"])])])]),key:"1"}:void 0]),1032,["modelValue"])}}};export{Ce as _,Ge as a};
//# sourceMappingURL=DeleteLinkedDocModal-82e5acc7.js.map
