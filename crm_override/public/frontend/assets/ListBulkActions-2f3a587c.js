import{_ as W,f as C,c as Y,d as a,N as z,O,l as h,e as U,g as A,a9 as ee,w as V,t as B,b as _,a5 as L,X as te,a as H,y as G,u as j,a7 as le,ab as R,a3 as E,V as q,$ as oe,a2 as I,F as K,r as se,Y as X,a4 as ae,a6 as N,B as J}from"./index-93b98c2f.js";import{a as ne}from"./DeleteLinkedDocModal-fbcb8e64.js";import{_ as ie,L as Q}from"./Link-2168dbe1.js";import{d as de}from"./DragVerticalIcon-daedf401.js";import{_ as ue}from"./settings-382ad993.js";import{_ as Z,F as re}from"./index-71945f41.js";import{g as ce}from"./global-08fb68c9.js";const me={},pe={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"fillCurrent",stroke:"currentColor","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-heart"};function fe(g,k){return C(),Y("svg",pe,[...k[0]||(k[0]=[a("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"},null,-1)])])}const Pe=W(me,[["render",fe]]),ve={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},_e={class:"mb-6 flex items-center justify-between"},ge={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},ye={class:"flex items-center gap-1"},ke={class:"text-ink-gray-5 text-base"},be={class:"px-4 pb-7 pt-0 sm:px-6"},he={class:"flex flex-row-reverse gap-2"},we={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Ve={class:"mb-6 flex items-center justify-between"},Ce={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},De={class:"flex items-center gap-1"},xe={class:"text-ink-gray-5 text-base"},Me={class:"px-4 pb-7 pt-0 sm:px-6"},$e={class:"flex flex-row-reverse gap-2"},Ae={__name:"BulkDeleteLinkedDocModal",props:z({doctype:{type:String,required:!0},items:{type:Array,required:!0},reload:{type:Function,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const k=O(g,"modelValue"),s=g,u=h({show:!1,title:"",message:"",delete:!1}),D=()=>{u.value={show:!0,title:__("Delete"),message:__("Are you sure you want to delete {0} linked doc(s)?",[s.items.length]),delete:!0}},m=()=>{u.value={show:!0,title:__("Unlink"),message:__("Are you sure you want to unlink {0} linked doc(s)?",[s.items.length]),delete:!1}},x=()=>{L("crm.api.doc.delete_bulk_docs",{items:s.items,doctype:s.doctype,delete_linked:u.value.delete}).then(()=>{u.value={show:!1,title:""},k.value=!1,s.reload()})};return(c,n)=>{const r=U("Button"),v=U("Dialog");return C(),A(v,{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=y=>k.value=y),options:{size:"xl"}},ee({body:V(()=>{var y;return[a("div",ve,[a("div",_e,[a("div",null,[a("h3",ge,B(c.__("Delete")),1)]),a("div",ye,[_(r,{variant:"ghost",icon:"x",onClick:n[0]||(n[0]=S=>k.value=!1)})])]),a("div",null,[a("div",ke,B(c.__("Are you sure you want to delete {0} items?",[(y=s.items)==null?void 0:y.length])),1)])]),a("div",be,[a("div",he,[_(r,{label:c.__("Delete {0} items",[s.items.length]),"icon-left":"trash-2",variant:"solid",theme:"red",onClick:n[1]||(n[1]=S=>D())},null,8,["label"]),_(r,{label:c.__("Unlink and delete {0} items",[s.items.length]),"icon-left":"unlock",variant:"solid",onClick:n[2]||(n[2]=S=>m())},null,8,["label"])])])]}),_:2},[u.value.show?{name:"body",fn:V(()=>[a("div",we,[a("div",Ve,[a("div",null,[a("h3",Ce,B(c.__("Delete")),1)]),a("div",De,[_(r,{variant:"ghost",icon:"x",onClick:n[3]||(n[3]=y=>k.value=!1)})])]),a("div",null,[a("div",xe,B(u.value.delete?c.__("This will delete selected items and items linked to it, are you sure?"):c.__("This will delete selected items and unlink linked items to it, are you sure?")),1)])]),a("div",Me,[a("div",$e,[_(r,{label:u.value.delete?c.__("Delete"):c.__("Unlink and delete"),"icon-left":u.value.delete?"trash-2":"unlock",variant:"solid",theme:"red",onClick:n[4]||(n[4]=y=>x())},null,8,["label","icon-left"]),_(r,{label:c.__("Cancel"),variant:"subtle",onClick:n[5]||(n[5]=y=>u.value.show=!1)},null,8,["label"])])])]),key:"0"}:void 0]),1032,["modelValue"])}}},Le={class:"mb-4"},Se={class:"mb-1.5 text-sm text-ink-gray-5"},Ue={class:"mb-1.5 text-sm text-ink-gray-5"},Be={__name:"EditValueModal",props:z({doctype:{type:String,required:!0},selectedValues:{type:Set,required:!0}},{modelValue:{},modelModifiers:{}}),emits:z(["reload"],["update:modelValue"]),setup(g,{emit:k}){const s=["Check"],u=["Link","Dynamic Link"],D=["Float","Int","Currency","Percent"],m=["Select"],x=["Text Editor"],c=["Date","Datetime"],n=g,r=O(g,"modelValue"),v=k,y=te({url:"crm.api.doc.get_fields",cache:["fields",n.doctype],params:{doctype:n.doctype},transform:t=>t.filter(e=>e.hidden==0&&e.read_only==0)});H(()=>{var t;(t=y.data)!=null&&t.length||y.fetch()});const S=G(()=>{var t;return((t=n.selectedValues)==null?void 0:t.size)||0}),d=h({label:"",fieldtype:"",fieldname:"",options:""}),o=h(""),p=h(!1);function M(){let t=o.value;d.value.fieldtype=="Check"&&(t=t=="Yes"?1:0),p.value=!0,L("frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",{doctype:n.doctype,docnames:Array.from(n.selectedValues),action:"update",data:{[d.value.fieldname]:t||null}}).then(()=>{d.value={label:"",fieldtype:"",fieldname:"",options:""},o.value="",p.value=!1,r.value=!1,R("bulk_update",{doctype:n.doctype}),v("reload")})}function T(t){o.value="",t&&(d.value=t)}function F(t){let e=t.target?t.target.value:t;o.value=e}function $(t){return t.split(`
`)}function b(t){const{fieldtype:e,options:l}=t;if(m.includes(e)||s.includes(e)){const i=e=="Check"?["Yes","No"]:$(l);return E(q,{type:"select",options:i.map(f=>({label:f,value:f})),modelValue:o.value})}else return u.includes(e)?e=="Dynamic Link"?E(q,{type:"text"}):E(Q,{class:"form-control",doctype:l}):D.includes(e)?E(q,{type:"number"}):c.includes(e)?E(de):x.includes(e)?E(ue,{variant:"outline",editorClass:"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-outline-gray-2 bg-surface-white hover:border-outline-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:o.value}):E(q,{type:"text"})}return(t,e)=>{const l=U("Button"),i=U("Dialog");return C(),A(i,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=f=>r.value=f),options:{title:t.__("Bulk Edit")}},{"body-content":V(()=>[a("div",Le,[a("div",Se,B(t.__("Field")),1),_(ie,{value:d.value.label,options:j(y).data,onChange:e[0]||(e[0]=f=>T(f)),placeholder:t.__("Source")},null,8,["value","options","placeholder"])]),a("div",null,[a("div",Ue,B(t.__("Value")),1),(C(),A(le(b(d.value)),{value:o.value,size:"md",onChange:e[1]||(e[1]=f=>F(f)),placeholder:t.__("Contact Us")},null,40,["value","placeholder"]))])]),actions:V(()=>[_(l,{class:"w-full",variant:"solid",onClick:M,loading:p.value,label:t.__("Update {0} Records",[S.value])},null,8,["loading","label"])]),_:1},8,["modelValue","options"])}}},Ee=["onClick"],Fe={class:"ml-1"},Ne={class:"cursor-pointer text-ink-gray-9"},je={class:"flex justify-between items-center gap-2"},ze={class:"flex items-center justify-end gap-2"},Te={__name:"AssignmentModal",props:z({doc:{type:Object,default:null},docs:{type:Set,default:new Set},doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{},assignees:{},assigneesModifiers:{}}),emits:z(["reload"],["update:modelValue","update:assignees"]),setup(g,{emit:k}){const s=g,u=k,D=O(g,"modelValue"),m=O(g,"assignees"),x=h([]),c=h(""),{users:n,getUser:r}=oe(),v=d=>{m.value=m.value.filter(o=>o.name!==d)};G(()=>s.doc?s.doctype=="CRM Lead"?s.doc.lead_owner:s.doc.deal_owner:"");const y=d=>{c.value="";let o={name:d,image:r(d).user_image,label:r(d).full_name};m.value.find(p=>p.name===d)||m.value.push(o)};async function S(){const d=x.value.filter(p=>!m.value.find(M=>M.name===p.name)).map(p=>p.name),o=m.value.filter(p=>!x.value.find(M=>M.name===p.name)).map(p=>p.name);d.length&&await L("crm.api.doc.remove_assignments",{doctype:s.doctype,name:s.doc.name,assignees:JSON.stringify(d)}),o.length&&(s.docs.size?(R("bulk_assign_to",{doctype:s.doctype}),L("frappe.desk.form.assign_to.add_multiple",{doctype:s.doctype,name:JSON.stringify(Array.from(s.docs)),assign_to:o,bulk_assign:!0,re_assign:!0}).then(()=>{u("reload")})):(R("assign_to",{doctype:s.doctype}),L("frappe.desk.form.assign_to.add",{doctype:s.doctype,name:s.doc.name,assign_to:o}))),D.value=!1}return H(()=>{x.value=[...m.value]}),(d,o)=>{const p=U("FeatherIcon"),M=U("Button"),T=U("ErrorMessage"),F=U("Dialog");return C(),A(F,{modelValue:D.value,"onUpdate:modelValue":o[5]||(o[5]=$=>D.value=$),options:{title:d.__("Assign To"),size:"xl"},onClose:o[6]||(o[6]=()=>m.value=[...x.value])},{"body-content":V(()=>{var $;return[_(Q,{class:"form-control",value:"",doctype:"User",onChange:o[2]||(o[2]=b=>y(b)&&(d.$refs.input.value="")),placeholder:d.__("John Doe"),filters:{name:["in",($=j(n).data.crmUsers)==null?void 0:$.map(b=>b.name)]},hideMe:!0},{target:V(({togglePopover:b})=>[a("div",{class:"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text",onClick:I(b,["stop"])},[(C(!0),Y(K,null,se(m.value,t=>(C(),A(j(X),{text:t.name,key:t.name,onClick:o[1]||(o[1]=I(()=>{},["stop"]))},{default:V(()=>[a("div",null,[a("div",{class:"flex items-center text-sm text-ink-gray-6 border border-outline-gray-1 bg-surface-white rounded-full hover:bg-surface-white !p-0.5",onClick:o[0]||(o[0]=I(()=>{},["stop"]))},[_(Z,{user:t.name,size:"sm"},null,8,["user"]),a("div",Fe,B(j(r)(t.name).full_name),1),_(M,{variant:"ghost",class:"rounded-full !size-4 m-1",onClick:I(e=>v(t.name),["stop"])},{icon:V(()=>[_(p,{name:"x",class:"h-3 w-3 text-ink-gray-6"})]),_:1},8,["onClick"])])])]),_:2},1032,["text"]))),128))],8,Ee)]),"item-prefix":V(({option:b})=>[_(Z,{class:"mr-2",user:b.value,size:"sm"},null,8,["user"])]),"item-label":V(({option:b})=>[_(j(X),{text:b.value},{default:V(()=>[a("div",Ne,B(j(r)(b.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder","filters"])]}),actions:V(()=>[a("div",je,[a("div",null,[_(T,{message:d.__(c.value)},null,8,["message"])]),a("div",ze,[_(M,{variant:"subtle",label:d.__("Cancel"),onClick:o[3]||(o[3]=()=>{m.value=[...x.value],D.value=!1})},null,8,["label"]),_(M,{variant:"solid",label:d.__("Update"),onClick:o[4]||(o[4]=$=>S())},null,8,["label"])])])]),_:1},8,["modelValue","options"])}}},Xe={__name:"ListBulkActions",props:z({doctype:{type:String,default:""},options:{type:Object,default:()=>({hideEdit:!1,hideDelete:!1,hideAssign:!1})}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g,{expose:k}){const s=g,u=O(g,"modelValue"),D=ae(),{$dialog:m,$socket:x}=ce(),c=h(!1),n=h([]),r=h(()=>{}),v=h({showLinkedDocsModal:!1,showDeleteModal:!1,docname:null});function y(e,l){n.value=e,c.value=!0,r.value=l}function S(e,l){m({title:__("Convert to Deal"),message:__("Are you sure you want to convert {0} Lead(s) to Deal(s)?",[e.size]),variant:"solid",theme:"blue",actions:[{label:__("Convert"),variant:"solid",onClick:i=>{R("bulk_convert_to_deal"),Array.from(e).forEach(f=>{L("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:f}).then(()=>{N.success(__("Converted successfully")),u.value.reload(),l(),i()})})}}]})}function d(e,l){r.value=l;const i=Array.from(e);i.length==1?v.value={showLinkedDocsModal:!0,docname:i[0]}:v.value={showDeleteModal:!0,items:i}}const o=h(!1),p=h([]);function M(e,l){o.value=!0,n.value=e,r.value=l}function T(e,l){m({title:__("Clear Assignment"),message:__("Are you sure you want to clear assignment for {0} item(s)?",[e.size]),variant:"solid",theme:"red",actions:[{label:__("Clear Assignment"),variant:"solid",theme:"red",onClick:i=>{R("bulk_clear_assignment"),L("frappe.desk.form.assign_to.remove_multiple",{doctype:s.doctype,names:JSON.stringify(Array.from(e)),ignore_permissions:!0}).then(()=>{N.success(__("Assignment cleared successfully")),t(l),i()})}}]})}const F=h([]),$=h([]);function b(e,l){let i=[];return s.options.hideEdit||i.push({label:__("Edit"),onClick:()=>y(e,l)}),s.options.hideDelete||i.push({label:__("Delete"),onClick:()=>d(e,l)}),s.options.hideAssign||(i.push({label:__("Assign To"),onClick:()=>M(e,l)}),i.push({label:__("Clear Assignment"),onClick:()=>T(e,l)})),s.doctype==="CRM Lead"&&i.push({label:__("Convert to Deal"),onClick:()=>S(e,l)}),F.value.forEach(f=>{i.push({label:__(f.label),onClick:()=>f.onClick({list:u.value,selections:e,unselectAll:l,call:L,createToast:N.create,toast:N,$dialog:m,router:D})})}),i}function t(e){var l,i;v.value={showLinkedDocsModal:!1,showDeleteModal:!1,docname:null},(l=r.value)==null||l.call(r),e==null||e(),(i=u.value)==null||i.reload()}return H(async()=>{var l,i,f,w,P;if(!((l=u.value)!=null&&l.data))return;let e=await re(u.value.data,{list:u.value,call:L,createToast:N.create,toast:N,$dialog:m,$socket:x,router:D});F.value=(e==null?void 0:e.bulkActions)||((f=(i=u.value)==null?void 0:i.data)==null?void 0:f.bulkActions)||[],$.value=(e==null?void 0:e.actions)||((P=(w=u.value)==null?void 0:w.data)==null?void 0:P.listActions)||[]}),k({bulkActions:b,customListActions:$}),(e,l)=>{const i=ne,f=Ae;return C(),Y(K,null,[c.value?(C(),A(Be,{key:0,modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=w=>c.value=w),doctype:g.doctype,selectedValues:n.value,onReload:t},null,8,["modelValue","doctype","selectedValues"])):J("",!0),o.value?(C(),A(Te,{key:1,modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=w=>o.value=w),assignees:p.value,"onUpdate:assignees":l[2]||(l[2]=w=>p.value=w),docs:n.value,doctype:g.doctype,onReload:t},null,8,["modelValue","assignees","docs","doctype"])):J("",!0),v.value.showLinkedDocsModal?(C(),A(i,{key:2,modelValue:v.value.showLinkedDocsModal,"onUpdate:modelValue":l[3]||(l[3]=w=>v.value.showLinkedDocsModal=w),doctype:s.doctype,docname:v.value.docname,reload:t},null,8,["modelValue","doctype","docname"])):J("",!0),v.value.showDeleteModal?(C(),A(f,{key:3,modelValue:v.value.showDeleteModal,"onUpdate:modelValue":l[4]||(l[4]=w=>v.value.showDeleteModal=w),doctype:s.doctype,items:v.value.items,reload:t},null,8,["modelValue","doctype","items"])):J("",!0)],64)}}};export{Pe as H,Xe as _};
//# sourceMappingURL=ListBulkActions-2f3a587c.js.map
