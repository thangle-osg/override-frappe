import{a as fe}from"./DeleteLinkedDocModal-fbcb8e64.js";import{_ as ge}from"./ErrorPage-7fbb6ba4.js";import{_ as ye}from"./Resizer-e380b9d7.js";import{u as ve,_ as he}from"./Icon-ddb7da91.js";import{g as be,S as we}from"./view-ee146f0d.js";import{L as ke}from"./LayoutHeader-a56044ed.js";import{P as Ce}from"./PhoneIcon-50343ce1.js";import{C as xe}from"./CameraIcon-e954dbad.js";import{D as De}from"./DealsIcon-14c40c69.js";import{_ as ze}from"./DealsListView-56ea56b1.js";import{_ as Se}from"./CustomActions-6b6c5428.js";import{b as U,f as Me,t as $e,s as Ie,a as H,D as Ve,v as Pe}from"./index-71945f41.js";import{u as Re,s as Te,a as Be,_ as Fe}from"./modals-677e544a.js";import{g as qe}from"./settings-382ad993.js";import{g as Le}from"./global-08fb68c9.js";import{$ as Ne,a0 as Ae,a4 as Ee,l as S,y as f,a3 as je,X as K,a5 as C,a6 as g,z as Oe,c as h,u as s,g as m,w as u,B as r,b as _,F as Ue,e as $,f as l,d as c,a7 as I,K as He,t as b,a8 as X,n as G}from"./index-93b98c2f.js";import{o as Ke}from"./organizations-b9a3171d.js";import{s as Xe}from"./statuses-e5e5b021.js";import{c as J}from"./DragVerticalIcon-daedf401.js";import{_ as Ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-4a817414.js";import{F as Je}from"./FileUploader-8e1f7619.js";import"./ListView-77d3ef8b.js";import"./FadedScrollableDiv-333e0c1f.js";import"./ArrowUpRightIcon-e1cc4500.js";import"./Link-2168dbe1.js";import"./ListBulkActions-2f3a587c.js";import"./MultipleAvatar-a2bd73d2.js";import"./IndicatorIcon-3bcbda75.js";import"./ListFooter-f8a588c3.js";import"./description-6bf3a432.js";const Qe={key:1,ref:"parentRef",class:"flex h-full"},We={class:"border-b"},Ye={class:"flex flex-col items-start justify-start gap-4 p-5"},Ze={class:"flex gap-4 items-center"},ea={class:"group relative h-15.5 w-15.5"},aa={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},ta={class:"flex flex-col gap-2 truncate text-ink-gray-9"},oa={class:"truncate text-2xl font-medium"},sa={key:0},na={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},la={class:""},ia={class:"flex gap-1.5"},ra={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},da={class:"flex flex-col items-center justify-center space-y-3"},Ea={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(Q){const{brand:W}=qe(),{makeCall:Y,$dialog:Z,$socket:ee}=Le(),{getUser:V}=Ne(),{getOrganization:P}=Ke(),{getDealStatus:ae}=Xe(),{doctypeMeta:te}=U("Contact"),w=Q,y=Ae(),oe=Ee(),R=S(""),se=S(""),{document:a,permissions:ne,scripts:T}=Re("Contact",w.contactId),le=f(()=>{var e,o;return((o=(e=ne.data)==null?void 0:e.permissions)==null?void 0:o.delete)||!1}),ie=f(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(y.query.view||y.query.viewType){let o=be(y.query.view,y.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return e.push({label:B.value,route:{name:"Contact",params:{contactId:w.contactId}}}),e}),B=f(()=>{var o,n;let e=((o=te.Contact)==null?void 0:o.title_field)||"name";return((n=a.doc)==null?void 0:n[e])||w.contactId});ve(()=>({title:B.value,icon:W.favicon}));const x=S(!1);async function F(){x.value=!0}function q(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{g.success(__("Contact image updated"))}})}const L=S(0),re=[{label:"Deals",icon:je(De,{class:"h-4 w-4"}),count:f(()=>{var e;return(e=D.data)==null?void 0:e.length})}],D=K({url:"crm.api.contact.get_linked_deals",cache:["deals",w.contactId],params:{contact:w.contactId},auto:!0}),M=f(()=>!D.data||D.data==[]?[]:D.data.map(e=>ue(e))),z=K({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),ce=f(()=>z.data?z.data.map(e=>({...e,columns:e.columns.map(o=>({...o,fields:o.fields.map(n=>{var p,k;return n.fieldname==="email_id"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(i=>({name:i.name,value:i.email_id,selected:i.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>N("email",i.email_id),onSave:(t,d)=>d?A("email",t.value):E("Contact Email",t.name,"email_id",t.value),onDelete:async(t,d)=>{a.doc.email_ids=a.doc.email_ids.filter(v=>v.name!==t.name),d||await j("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="mobile_no"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((k=a.doc)==null?void 0:k.phone_nos)||[]).map(i=>({name:i.name,value:i.phone,selected:i.phone===a.doc.mobile_no,onClick:()=>N("mobile_no",i.phone),onSave:(t,d)=>d?A("phone",t.value):E("Contact Phone",t.name,"phone",t.value),onDelete:async(t,d)=>{a.doc.phone_nos=a.doc.phone_nos.filter(v=>v.name!==t.name),d||await j("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="address"?{...n,create:(i,t)=>{O(),t&&t()},edit:i=>O(i)}:n})}))})):[]);async function N(e,o){await C("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function A(e,o){if(!o)return;await C("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function E(e,o,n,p){await C("frappe.client.set_value",{doctype:e,name:o,fieldname:n,value:p})&&(a.reload(),g.success(__("Contact updated")))}async function j(e,o){await C("frappe.client.delete",{doctype:e,name:o}),await a.reload(),g.success(__("Contact updated"))}const{getFormattedCurrency:de}=U("CRM Deal"),me=f(()=>_e);function ue(e){var o,n;return{name:e.name,organization:{label:e.organization,logo:(o=P(e.organization))==null?void 0:o.organization_logo},annual_revenue:de("annual_revenue",e),status:{label:e.status,color:(n=ae(e.status))==null?void 0:n.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&V(e.deal_owner).full_name,...e.deal_owner&&V(e.deal_owner)},modified:{label:Me(e.modified),timeAgo:__($e(e.modified))}}}const _e=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function O(e){Te.value=!0,Be.value={doctype:"Address",address:e}}return Oe(()=>a.doc,async e=>{var o;if((o=T.data)!=null&&o.length){let n=await Ie(T.data,{doc:e,$dialog:Z,$socket:ee,router:oe,toast:g,updateField:a.setValue.submit,createToast:g.create,deleteDoc:F,call:C});a._actions=n.actions||[]}},{once:!0}),(e,o)=>{const n=$("ErrorMessage"),p=$("Button"),k=$("Badge"),i=fe;return l(),h(Ue,null,[s(a).doc?(l(),m(ke,{key:0},{"left-header":u(()=>[_(s(Ge),{items:ie.value},{prefix:u(({item:t})=>[t.icon?(l(),m(he,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])]),"right-header":u(()=>{var t;return[(t=s(a)._actions)!=null&&t.length?(l(),m(Se,{key:0,actions:s(a)._actions},null,8,["actions"])):r("",!0)]}),_:1})):r("",!0),s(a).doc?(l(),h("div",Qe,[s(a).doc?(l(),m(ye,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:u(()=>[c("div",We,[_(s(Je),{onSuccess:q,validateFile:s(Pe)},{default:u(({openFileSelector:t,error:d})=>{var v;return[c("div",Ye,[c("div",Ze,[c("div",ea,[_(s(H),{size:"3xl",class:"h-15.5 w-15.5",label:s(a).doc.full_name,image:s(a).doc.image},null,8,["label","image"]),(l(),m(I(s(a).doc.image?s(Ve):"div"),He(s(a).doc.image?{options:[{icon:"upload",label:s(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>q("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[c("div",aa,[_(xe,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),c("div",ta,[c("div",oa,[s(a).doc.salutation?(l(),h("span",sa,b(s(a).doc.salutation+". "),1)):r("",!0),c("span",null,b(s(a).doc.full_name),1)]),s(a).doc.company_name?(l(),h("div",na,[_(s(H),{size:"xs",label:s(a).doc.company_name,image:(v=s(P)(s(a).doc.company_name))==null?void 0:v.organization_logo},null,8,["label","image"]),c("span",la,b(s(a).doc.company_name),1)])):r("",!0),_(n,{message:e.__(d)},null,8,["message"])])]),c("div",ia,[s(J)&&s(a).doc.mobile_no?(l(),m(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:Ce,onClick:o[0]||(o[0]=pe=>s(J)&&s(Y)(s(a).doc.mobile_no))},null,8,["label"])):r("",!0),le.value?(l(),m(p,{key:1,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:o[1]||(o[1]=pe=>F())},null,8,["label"])):r("",!0)])])]}),_:1},8,["validateFile"])]),s(z).data?(l(),h("div",ra,[_(we,{sections:ce.value,doctype:"Contact",docname:s(a).doc.name,onReload:s(z).reload},null,8,["sections","docname","onReload"])])):r("",!0)]),_:1},8,["parent"])):r("",!0),_(s(Fe),{as:"div",modelValue:L.value,"onUpdate:modelValue":o[2]||(o[2]=t=>L.value=t),tabs:re},{"tab-item":u(({tab:t,selected:d})=>[c("button",{class:G(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":d}])},[t.icon?(l(),m(I(t.icon),{key:0,class:"h-5"})):r("",!0),X(" "+b(e.__(t.label))+" ",1),_(k,{class:G(["group-hover:bg-surface-gray-7",[d?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[X(b(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":u(({tab:t})=>[t.label==="Deals"&&M.value.length?(l(),m(ze,{key:0,class:"mt-4",rows:M.value,columns:me.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),M.value.length?r("",!0):(l(),h("div",ca,[c("div",da,[(l(),m(I(t.icon),{class:"!h-10 !w-10"})),c("div",null,b(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):R.value?(l(),m(ge,{key:2,errorTitle:R.value,errorMessage:se.value},null,8,["errorTitle","errorMessage"])):r("",!0),x.value?(l(),m(i,{key:3,modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=t=>x.value=t),doctype:"Contact",docname:s(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):r("",!0)],64)}}};export{Ea as default};
//# sourceMappingURL=Contact-85e60ec1.js.map
