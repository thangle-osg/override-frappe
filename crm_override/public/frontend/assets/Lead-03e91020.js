import{a as ye}from"./DeleteLinkedDocModal-82e5acc7.js";import{_ as be}from"./ErrorPage-45ccdeb5.js";import{u as he,_ as Ce}from"./Icon-84cd6660.js";import{_ as ke}from"./Resizer-ba6ebf52.js";import{A as we,a as te,u as xe,_ as Me,b as Ie,c as Ee,S as Ve}from"./useActiveTabManager-c1b70da0.js";import{E as Le}from"./Popover-a5a93374.js";import{E as $e}from"./Email2Icon-8a961053.js";import{C as Re}from"./CommentIcon-233c341d.js";import{D as De}from"./DetailsIcon-5874e315.js";import{P as oe}from"./PhoneIcon-ecda9a20.js";import{T as Se}from"./TaskIcon-ffda7412.js";import{N as Ae}from"./NoteModal-89d49e2b.js";import{W as Te}from"./WhatsAppIcon-c8486815.js";import{I as ze}from"./IndicatorIcon-a31cdeff.js";import{C as qe}from"./CameraIcon-1cffe6d8.js";import{L as Oe}from"./LinkIcon-71d83ee9.js";import{L as Fe}from"./LayoutHeader-3487ee06.js";import{g as Ue,S as Ne}from"./view-69c9883d.js";import{_ as le}from"./CustomActions-d0f0988f.js";import{O as Be}from"./OrganizationsIcon-b081d8bb.js";import{C as je}from"./ContactsIcon-19e43cad.js";import{i as Pe,E as We,w as Ge,c as Qe}from"./DragVerticalIcon-415e0cb3.js";import{F as He}from"./FieldLayout-59ef2509.js";import{L as se}from"./Link-19e58904.js";import{u as ee,c as Ke,q as Xe,_ as Ye}from"./modals-0bc101bf.js";import{N as Je,O as Ze,a4 as de,$ as ea,a1 as aa,l as b,y as A,X as ce,e as G,f as i,g as d,w as p,d as u,t as E,u as o,B as m,b as n,c as O,W as ta,a5 as me,ab as oa,a0 as la,z as ne,a9 as sa,aa as ie,F as na,a6 as q,n as ia,K as ra,a7 as ua,Y as da,G as ca}from"./index-47f22653.js";import{s as ve}from"./statuses-b352e6be.js";import{h as re,b as ma,s as va,D as ue,e as pa,v as fa,a as _a,o as ga}from"./index-7044dffb.js";import{u as ya}from"./helpCenter-1e377cf1.js";import{g as ba}from"./settings-95652367.js";import{g as ha}from"./global-cfeec981.js";import{_ as Ca}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-5fda7ab7.js";import{F as ka}from"./FileUploader-bb9cbac3.js";import"./ListView-817be4d7.js";import"./CalendarIcon-810a0d26.js";import"./CallLogModal-b2da476e.js";import"./ArrowUpRightIcon-01dbc17d.js";import"./LeadsIcon-769e73dd.js";import"./DealsIcon-5a4a79e4.js";import"./TaskModal-f40440e4.js";import"./FadedScrollableDiv-881424bc.js";import"./MultipleAvatar-5ebc1733.js";import"./IconPicker-bf53b6c5.js";const wa={class:"mb-6 flex items-center justify-between"},xa={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Ma={class:"flex items-center gap-1"},Ia={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Ea={class:"block text-base"},Va={class:"ml-6 text-ink-gray-9"},La={class:"flex items-center justify-between text-base"},$a={key:1,class:"mt-2.5 text-base"},Ra={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Da={class:"block text-base"},Sa={class:"ml-6 text-ink-gray-9"},Aa={class:"flex items-center justify-between text-base"},Ta={key:1,class:"mt-2.5 text-base"},za={key:0,class:"h-px w-full border-t my-6"},qa={class:"flex justify-end"},Oa={__name:"ConvertToDealModal",props:Je({lead:{type:Object,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const F=h,V=Ze(h,"modelValue"),Q=de(),{statusOptions:H,getDealStatus:K}=ve(),{isManager:X}=ea(),{user:Y}=aa(),{updateOnboardingStep:L}=ya("frappecrm"),$=b(!1),x=b(!1),C=b(""),f=b(""),v=b(""),{triggerConvertToDeal:R}=ee("CRM Lead",F.lead.name),{document:_}=ee("CRM Deal");async function T(){if(v.value="",$.value&&!C.value){v.value=__("Please select an existing contact");return}if(x.value&&!f.value){v.value=__("Please select an existing organization");return}!$.value&&C.value&&(C.value=""),!x.value&&f.value&&(f.value=""),await(R==null?void 0:R(F.lead,_.doc,()=>V.value=!1));let r=await me("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:F.lead.name,deal:_.doc,existing_contact:C.value,existing_organization:f.value}).catch(t=>{var k;if(t.exc_type=="MandatoryError"){const I=t.messages.map(g=>{let l=g.split(": ");return l[l.length-1].trim()}).join(", ");I.toLowerCase().includes("required")?v.value=__(I):v.value=__("{0} is required",[I]);return}v.value=__("Error converting to deal: {0}",[(k=t.messages)==null?void 0:k[0]])});r&&(V.value=!1,$.value=!1,x.value=!1,C.value="",f.value="",v.value="",L("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+Y,r)}),oa("convert_lead_to_deal"),Q.push({name:"Deal",params:{dealId:r}}))}const U=A(()=>{var t;let r=H("deal");return(t=_.doc)!=null&&t.status||(_.doc.status=r[0].value),r}),N=ce({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:r=>{let t=!1,k=r==null?void 0:r.forEach(I=>{var g;(g=I.sections)==null||g.forEach(l=>{var y;(y=l.columns)==null||y.forEach(z=>{var P;(P=z.fields)==null||P.forEach(w=>{t=!0,w.fieldname=="status"&&(w.fieldtype="Select",w.options=U.value,w.prefix=K(_.doc.status).color),w.fieldtype==="Table"&&(_.doc[w.fieldname]=[])})})})});return t?k:[]}});function B(){Ke.value=!0,Xe.value={doctype:"CRM Deal",onlyRequired:!0},V.value=!1}return(r,t)=>{const k=G("Button"),I=G("ErrorMessage");return i(),d(o(ta),{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=g=>V.value=g),options:{size:"xl"}},{"body-header":p(()=>[u("div",wa,[u("div",null,[u("h3",xa,E(r.__("Convert to Deal")),1)]),u("div",Ma,[o(X)()&&!o(Pe)?(i(),d(k,{key:0,variant:"ghost",tooltip:r.__("Edit deal's mandatory fields layout"),icon:We,onClick:B},null,8,["tooltip"])):m("",!0),n(k,{icon:"x",variant:"ghost",onClick:t[0]||(t[0]=g=>V.value=!1)})])])]),"body-content":p(()=>{var g,l;return[u("div",Ia,[n(Be,{class:"h-4 w-4"}),u("label",Ea,E(r.__("Organization")),1)]),u("div",Va,[u("div",La,[u("div",null,E(r.__("Choose Existing")),1),n(o(re),{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=y=>x.value=y)},null,8,["modelValue"])]),x.value?(i(),d(se,{key:0,class:"form-control mt-2.5",size:"md",value:f.value,doctype:"CRM Organization",onChange:t[2]||(t[2]=y=>f.value=y)},null,8,["value"])):(i(),O("div",$a,E(r.__("New organization will be created based on the data in details section")),1))]),u("div",Ra,[n(je,{class:"h-4 w-4"}),u("label",Da,E(r.__("Contact")),1)]),u("div",Sa,[u("div",Aa,[u("div",null,E(r.__("Choose Existing")),1),n(o(re),{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=y=>$.value=y)},null,8,["modelValue"])]),$.value?(i(),d(se,{key:0,class:"form-control mt-2.5",size:"md",value:C.value,doctype:"Contact",onChange:t[4]||(t[4]=y=>C.value=y)},null,8,["value"])):(i(),O("div",Ta,E(r.__("New contact will be created based on the person's details")),1))]),(g=o(N).data)!=null&&g.length?(i(),O("div",za)):m("",!0),(l=o(N).data)!=null&&l.length?(i(),d(He,{key:1,tabs:o(N).data,data:o(_).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):m("",!0),n(I,{class:"mt-4",message:v.value},null,8,["message"])]}),actions:p(()=>[u("div",qa,[n(k,{label:r.__("Convert"),variant:"solid",onClick:T},null,8,["label"])])]),_:1},8,["modelValue"])}}},Fa={key:0,class:"flex h-full overflow-hidden"},Ua={class:"flex items-center justify-start gap-5 border-b p-5"},Na={class:"group relative size-12"},Ba={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ja={class:"flex flex-col gap-2.5 truncate"},Pa={class:"truncate text-2xl font-medium text-ink-gray-9"},Wa={class:"flex gap-1.5"},Ga={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},zt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(h){const{brand:F}=ba(),{$dialog:V,$socket:Q,makeCall:H}=ha(),{statusOptions:K,getLeadStatus:X}=ve(),{doctypeMeta:Y}=ma("CRM Lead"),L=la(),$=de(),x=h,C=b(!1),f=b(null),v=b(""),R=b(""),_=b(!1),T=b(!1),U=b(!1),{triggerOnChange:N,assignees:B,permissions:r,document:t,scripts:k,error:I}=ee("CRM Lead",x.leadId),g=A(()=>{var e,a;return((a=(e=r.data)==null?void 0:e.permissions)==null?void 0:a.delete)||!1}),l=A(()=>t.doc||{});ne(I,e=>{var a;e?(v.value=__(e.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),R.value=__(((a=e.messages)==null?void 0:a[0])||"An error occurred")):(v.value="",R.value="")}),ne(()=>t.doc,async e=>{var a;if((a=k.data)!=null&&a.length){let c=await va(k.data,{doc:e,$dialog:V,$socket:Q,router:$,toast:q,updateField:W,createToast:q.create,deleteDoc:ae,call:me});t._actions=c.actions||[],t._statuses=c.statuses||[]}},{once:!0});const y=A(()=>{let e=[{label:__("Leads"),route:{name:"Leads"}}];if(L.query.view||L.query.viewType){let a=Ue(L.query.view,L.query.viewType,"CRM Lead");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Leads",params:{viewType:L.query.viewType},query:{view:L.query.view}}})}return e.push({label:z.value,route:{name:"Lead",params:{leadId:x.leadId}}}),e}),z=A(()=>{var a,c;let e=((a=Y["CRM Lead"])==null?void 0:a.title_field)||"name";return((c=l.value)==null?void 0:c[e])||x.leadId}),P=A(()=>{var a;let e=(a=t.statuses)!=null&&a.length?t.statuses:t._statuses||[];return K("lead",e,fe)});he(()=>({title:z.value,icon:F.favicon}));const w=A(()=>[{name:"Activity",label:__("Activity"),icon:we},{name:"Emails",label:__("Emails"),icon:Le},{name:"Comments",label:__("Comments"),icon:Re},{name:"Data",label:__("Data"),icon:De},{name:"Calls",label:__("Calls"),icon:oe},{name:"Tasks",label:__("Tasks"),icon:Se},{name:"Notes",label:__("Notes"),icon:Ae},{name:"Attachments",label:__("Attachments"),icon:te},{name:"WhatsApp",label:__("WhatsApp"),icon:Te,condition:()=>Ge.value}].filter(a=>a.condition?a.condition():!0)),{tabIndex:D,changeTabTo:pe}=xe(w,"lastLeadTab"),J=ce({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});async function fe(e){await N("status",e),t.save.submit()}function W(e,a){a=Array.isArray(e)?"":a;let c=Array.isArray(e)?{}:l.value[e];Array.isArray(e)?e.forEach(j=>l.value[j]=a):l.value[e]=a,t.save.submit(null,{onSuccess:()=>C.value=!0,onError:j=>{var s;Array.isArray(e)?e.forEach(M=>l.value[M]=c[M]):l.value[e]=c,q.error(((s=j.messages)==null?void 0:s[0])||__("Error updating field"))}})}function ae(){_.value=!0}function _e(){let e=w.value[D.value];["Emails","Comments","Activities"].includes(e.name)||f.value.changeTabTo("emails"),ca(()=>f.value.emailBox.show=!0)}function ge(e){t.save.submit(null,{onSuccess:()=>Z(e)})}function Z(e){e!=null&&e.hasOwnProperty("lead_owner")&&B.reload()}return(e,a)=>{const c=G("Button"),j=G("ErrorMessage");return i(),O(na,null,[n(Fe,null,sa({"left-header":p(()=>[n(o(Ca),{items:y.value},{prefix:p(({item:s})=>[s.icon?(i(),d(Ce,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"])]),_:2},[v.value?void 0:{name:"right-header",fn:p(()=>{var s,M;return[(s=o(t)._actions)!=null&&s.length?(i(),d(le,{key:0,actions:o(t)._actions},null,8,["actions"])):m("",!0),(M=o(t).actions)!=null&&M.length?(i(),d(le,{key:1,actions:o(t).actions},null,8,["actions"])):m("",!0),n(Ie,{modelValue:o(B).data,"onUpdate:modelValue":a[0]||(a[0]=S=>o(B).data=S),doctype:"CRM Lead",docname:h.leadId},null,8,["modelValue","docname"]),l.value&&o(t).statuses?(i(),d(o(ue),{key:2,options:P.value,placement:"right"},{default:p(({open:S})=>[l.value.status?(i(),d(c,{key:0,label:l.value.status,iconRight:S?"chevron-up":"chevron-down"},{prefix:p(()=>[n(ze,{class:ia(o(X)(l.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])):m("",!0)]),_:1},8,["options"])):m("",!0),n(c,{label:e.__("Convert to Deal"),variant:"solid",onClick:a[1]||(a[1]=S=>T.value=!0)},null,8,["label"])]}),key:"0"}]),1024),l.value.name?(i(),O("div",Fa,[n(o(Ye),{as:"div",modelValue:o(D),"onUpdate:modelValue":a[4]||(a[4]=s=>ie(D)?D.value=s:null),tabs:w.value},{"tab-panel":p(()=>[n(Ee,{ref_key:"activities",ref:f,doctype:"CRM Lead",docname:h.leadId,tabs:w.value,reload:C.value,"onUpdate:reload":a[2]||(a[2]=s=>C.value=s),tabIndex:o(D),"onUpdate:tabIndex":a[3]||(a[3]=s=>ie(D)?D.value=s:null),onBeforeSave:ge,onAfterSave:Z},null,8,["docname","tabs","reload","tabIndex"])]),_:1},8,["modelValue","tabs"]),n(ke,{class:"flex flex-col justify-between border-l",side:"right"},{default:p(()=>[u("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:a[5]||(a[5]=s=>o(pa)(h.leadId))},E(e.__(h.leadId)),1),n(o(ka),{onSuccess:a[7]||(a[7]=s=>W("image",s.file_url)),validateFile:o(fa)},{default:p(({openFileSelector:s,error:M})=>[u("div",Ua,[u("div",Na,[n(o(_a),{size:"3xl",class:"size-12",label:z.value,image:l.value.image},null,8,["label","image"]),(i(),d(ua(l.value.image?o(ue):"div"),ra(l.value.image?{options:[{icon:"upload",label:l.value.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>W("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[u("div",Ba,[n(qe,{class:"size-4 cursor-pointer text-white"})])]),_:1},16))]),u("div",ja,[n(o(da),{text:l.value.lead_name||e.__("Set first name")},{default:p(()=>[u("div",Pa,E(z.value),1)]),_:1},8,["text"]),u("div",Wa,[o(Qe)?(i(),d(c,{key:0,tooltip:e.__("Make a call"),icon:oe,onClick:()=>l.value.mobile_no?o(H)(l.value.mobile_no):o(q).error(e.__("No phone number set"))},null,8,["tooltip","onClick"])):m("",!0),n(c,{tooltip:e.__("Send an email"),icon:$e,onClick:S=>l.value.email?_e():o(q).error(e.__("No email set"))},null,8,["tooltip","onClick"]),n(c,{tooltip:e.__("Go to website"),icon:Oe,onClick:S=>l.value.website?o(ga)(l.value.website):o(q).error(e.__("No website set"))},null,8,["tooltip","onClick"]),n(c,{tooltip:e.__("Attach a file"),icon:te,onClick:a[6]||(a[6]=S=>U.value=!0)},null,8,["tooltip"]),g.value?(i(),d(c,{key:1,tooltip:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:ae},null,8,["tooltip"])):m("",!0)]),n(j,{message:e.__(M)},null,8,["message"])])])]),_:1},8,["validateFile"]),l.value.sla_status?(i(),d(Ve,{key:0,modelValue:l.value,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value=s),onUpdateField:W},null,8,["modelValue"])):m("",!0),o(J).data?(i(),O("div",Ga,[n(Ne,{sections:o(J).data,doctype:"CRM Lead",docname:h.leadId,onReload:o(J).reload,onAfterFieldChange:Z},null,8,["sections","docname","onReload"])])):m("",!0)]),_:1})])):v.value?(i(),d(be,{key:1,errorTitle:v.value,errorMessage:R.value},null,8,["errorTitle","errorMessage"])):m("",!0),T.value?(i(),d(Oa,{key:2,modelValue:T.value,"onUpdate:modelValue":a[9]||(a[9]=s=>T.value=s),lead:l.value},null,8,["modelValue","lead"])):m("",!0),n(Me,{modelValue:U.value,"onUpdate:modelValue":a[10]||(a[10]=s=>U.value=s),doctype:"CRM Lead",docname:h.leadId,onAfter:a[11]||(a[11]=()=>{var s,M;(M=(s=f.value)==null?void 0:s.all_activities)==null||M.reload(),o(pe)("attachments")})},null,8,["modelValue","docname"]),_.value?(i(),d(ye,{key:3,modelValue:_.value,"onUpdate:modelValue":a[12]||(a[12]=s=>_.value=s),doctype:"CRM Lead",docname:h.leadId,name:"Leads"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{zt as default};
//# sourceMappingURL=Lead-03e91020.js.map
