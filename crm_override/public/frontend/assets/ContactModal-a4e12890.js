import{F as N}from"./FieldLayout-59ef2509.js";import{i as j,E as D}from"./DragVerticalIcon-415e0cb3.js";import{_ as Q,N as A,$ as O,a4 as q,O as F,l as k,X as P,a as R,G as E,e as y,f as m,g as p,w as S,d as l,t as T,u as i,B as v,b as M,a5 as U,ab as $}from"./index-47f22653.js";import{u as z,s as G,a as L,c as X,q as H}from"./modals-0bc101bf.js";const J={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},K={class:"mb-5 flex items-center justify-between"},W={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Y={class:"flex items-center gap-1"},Z={class:"px-4 pb-7 pt-4 sm:px-6"},ee={class:"space-y-2"},ae={__name:"ContactModal",props:A({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const c=b,{isManager:w}=O(),x=q(),d=F(b,"modelValue"),_=k(!1),u=k(null),{document:a,triggerOnBeforeCreate:f}=z("Contact");async function V(){_.value=!0,u.value=null,a.doc.email_id&&(a.doc.email_ids=[{email_id:a.doc.email_id,is_primary:1}],delete a.doc.email_id),a.doc.mobile_no&&(a.doc.phone_nos=[{phone:a.doc.mobile_no,is_primary_mobile_no:1}],delete a.doc.mobile_no),await(f==null?void 0:f());const e=await U("frappe.client.insert",{doc:{doctype:"Contact",...a.doc}},{onError:t=>{var o,r;u.value=(r=(o=t.error)==null?void 0:o.messages)==null?void 0:r[0],_.value=!1}});e.name&&($("contact_created"),I(e))}function I(e){var t,o;(o=(t=c.contact)==null?void 0:t.reload)==null||o.call(t),e.name&&c.options.redirect&&x.push({name:"Contact",params:{contactId:e.name}}),d.value=!1,c.options.afterInsert&&c.options.afterInsert(e)}const g=P({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:e=>e.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(r=>{r.fields.forEach(s=>{s.fieldname=="email_id"||s.fieldname=="mobile_no"?s.read_only=!1:s.fieldname=="address"?(s.create=(n,C)=>{a.doc.address=n,h(),C()},s.edit=n=>h(n)):s.fieldtype==="Table"&&(a.doc[s.fieldname]=[])})})})})});R(()=>{a.doc={},Object.assign(a.doc,c.contact.data||c.contact)});function B(){X.value=!0,H.value={doctype:"Contact"},E(()=>d.value=!1)}function h(e){G.value=!0,L.value={doctype:"Address",address:e},E(()=>d.value=!1)}return(e,t)=>{const o=y("Button"),r=y("ErrorMessage"),s=y("Dialog");return m(),p(s,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),options:{size:"xl"}},{body:S(()=>{var n;return[l("div",J,[l("div",K,[l("div",null,[l("h3",W,T(e.__("New Contact")),1)]),l("div",Y,[i(w)()&&!i(j)?(m(),p(o,{key:0,variant:"ghost",class:"w-7",tooltip:e.__("Edit fields layout"),icon:D,onClick:B},null,8,["tooltip"])):v("",!0),M(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=C=>d.value=!1),icon:"x"})])]),(n=i(g).data)!=null&&n.length?(m(),p(N,{key:0,tabs:i(g).data,data:i(a).doc,doctype:"Contact"},null,8,["tabs","data"])):v("",!0),u.value?(m(),p(r,{key:1,class:"mt-8",message:e.__(u.value)},null,8,["message"])):v("",!0)]),l("div",Z,[l("div",ee,[M(o,{class:"w-full",variant:"solid",label:e.__("Create"),loading:_.value,onClick:V},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},le=Q(ae,[["__scopeId","data-v-4b8b7c64"]]);export{le as C};
//# sourceMappingURL=ContactModal-a4e12890.js.map
