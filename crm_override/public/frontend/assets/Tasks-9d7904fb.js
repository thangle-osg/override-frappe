import{N as X,O as Z,y as I,a1 as ne,z as ie,l as M,e as W,f as a,c as d,b as l,w as f,u as k,F as j,r as re,g as b,n as N,B as y,Y as P,d as h,t as $,a2 as H,$ as ue,a4 as de,a5 as pe}from"./index-47f22653.js";import{_ as ce}from"./ViewBreadcrumbs-403f3aae.js";import{_ as fe}from"./CustomActions-d0f0988f.js";import{A as me}from"./ArrowUpRightIcon-01dbc17d.js";import{f as S,k as Y,j as K,a as O,D as te,b as _e,t as ke}from"./index-7044dffb.js";import{E as ve}from"./Email2Icon-8a961053.js";import{L as ye}from"./LayoutHeader-3487ee06.js";import{_ as ge}from"./ViewControls-8c13b8ab.js";import{H as ee,_ as Ce}from"./ListBulkActions-f0407178.js";import{C as be}from"./CalendarIcon-810a0d26.js";import{_ as we}from"./DeleteLinkedDocModal-82e5acc7.js";import{_ as he,a as xe,b as Me,c as $e,d as Ve}from"./ListView-817be4d7.js";import{_ as Le}from"./ListFooter-4bfc1f8a.js";import{_ as Te}from"./KanbanView-1838f3ab.js";import{T as Ue}from"./TaskModal-f40440e4.js";import{_ as Re}from"./settings-95652367.js";import"./Icon-84cd6660.js";import"./DragVerticalIcon-415e0cb3.js";import"./Link-19e58904.js";import"./FadedScrollableDiv-881424bc.js";import"./RefreshIcon-c66a2c4b.js";import"./IconPicker-bf53b6c5.js";import"./PinIcon-5132b115.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-404d97ac.js";import"./DetailsIcon-5874e315.js";import"./global-cfeec981.js";import"./description-7674fa11.js";import"./IndicatorIcon-a31cdeff.js";import"./helpCenter-1e377cf1.js";const Ae={key:0},De={class:"flex items-center gap-2 truncate text-base"},ze={key:0,class:"truncate"},Be={key:0},Pe={key:1},Se={key:2},Fe=["onClick"],Ee=["innerHTML"],Ie={key:2},We={key:3},je=["onClick"],He={__name:"TasksListView",props:X({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:X(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(g,{expose:F,emit:E}){const w=E,R=Z(g,"modelValue"),z=Z(g,"list"),B=I(()=>{var v,n;return!!((n=(v=z.value.params)==null?void 0:v.filters)!=null&&n._liked_by)}),{user:r}=ne();function A(v){if(v)return JSON.parse(v).includes(r)}ie(R,(v,n)=>{v!==n&&w("updatePageCount",v)});const T=M(null);return F({customListActions:I(()=>{var v;return(v=T.value)==null?void 0:v.customListActions})}),(v,n)=>{const i=W("Button"),V=W("FormControl");return a(),d(j,null,[l(k(Ve),{columns:g.columns,rows:g.rows,options:{onRowClick:c=>w("showTask",c.name),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name","onUpdate:selections":n[2]||(n[2]=c=>w("selectionsChanged",c))},{default:f(()=>[l(k(he),{class:"mx-3 sm:mx-5",onColumnWidthUpdated:n[1]||(n[1]=c=>w("columnWidthUpdated"))},{default:f(()=>[(a(!0),d(j,null,re(g.columns,c=>(a(),b(k(xe),{key:c.key,item:c,onColumnWidthUpdated:m=>w("columnWidthUpdated",c)},{default:f(()=>[c.key=="_liked_by"?(a(),b(i,{key:0,variant:"ghosted",class:N(["!h-4",B.value?"fill-red-500":"fill-white"]),onClick:n[0]||(n[0]=()=>w("applyLikeFilter"))},{default:f(()=>[l(ee,{class:"h-4 w-4"})]),_:1},8,["class"])):y("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),l(we,{class:"mx-3 sm:mx-5",rows:g.rows,doctype:"CRM Task"},{default:f(({idx:c,column:m,item:p})=>[m.key==="due_date"?(a(),d("div",Ae,[l(k(P),{text:p&&k(S)(p,"ddd, MMM D, YYYY | hh:mm a")},{default:f(()=>[h("div",De,[h("div",null,[l(be)]),p?(a(),d("div",ze,$(k(S)(p,"D MMM, hh:mm a")),1)):y("",!0)])]),_:2},1032,["text"])])):(a(),b(k(Me),{key:1,item:p,align:m.align},{prefix:f(()=>[m.key==="status"?(a(),d("div",Be,[l(Y,{status:p},null,8,["status"])])):m.key==="priority"?(a(),d("div",Pe,[l(K,{priority:p},null,8,["priority"])])):m.key==="assigned_to"?(a(),d("div",Se,[p.full_name?(a(),b(k(O),{key:0,class:"flex items-center",image:p.user_image,label:p.full_name,size:"sm"},null,8,["image","label"])):y("",!0)])):y("",!0)]),default:f(({label:D})=>[["modified","creation"].includes(m.key)?(a(),d("div",{key:0,class:"truncate text-base",onClick:U=>w("applyFilter",{event:U,idx:c,column:m,item:p,firstColumn:g.columns[0]})},[l(k(P),{text:p.label},{default:f(()=>[h("div",null,$(p.timeAgo),1)]),_:2},1032,["text"])],8,Fe)):m.type==="Text Editor"?(a(),d("div",{key:1,innerHTML:p,class:"truncate text-base h-4 [&>p]:truncate"},null,8,Ee)):m.type==="Check"?(a(),d("div",Ie,[l(V,{type:"checkbox",modelValue:p,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):m.key==="_liked_by"?(a(),d("div",We,[m.key=="_liked_by"?(a(),b(i,{key:0,variant:"ghosted",class:N(A(p)?"fill-red-500":"fill-white"),onClick:H(()=>w("likeDoc",{name:v.row.name,liked:A(p)}),["stop","prevent"])},{default:f(()=>[l(ee,{class:"h-4 w-4"})]),_:1},8,["class","onClick"])):y("",!0)])):(a(),d("div",{key:4,class:"truncate text-base",onClick:U=>w("applyFilter",{event:U,idx:c,column:m,item:p,firstColumn:g.columns[0]})},$(D),9,je))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),l(k($e),null,{actions:f(({selections:c,unselectAll:m})=>[l(k(te),{options:T.value.bulkActions(c,m)},{default:f(()=>[l(i,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),l(k(Le),{class:"border-t px-3 py-2 sm:px-5",modelValue:R.value,"onUpdate:modelValue":n[3]||(n[3]=c=>R.value=c),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:n[4]||(n[4]=c=>w("loadMore"))},null,8,["modelValue","options"]),l(Ce,{ref_key:"listBulkActionsRef",ref:T,modelValue:z.value,"onUpdate:modelValue":n[5]||(n[5]=c=>z.value=c),doctype:"CRM Task",options:{hideAssign:!0}},null,8,["modelValue"])],64)}}},Ye={class:"flex items-center gap-2"},Ke={key:0},Oe={key:1},qe={key:2},Je={key:3,class:"truncate text-base"},Ge={key:4,class:"truncate text-base"},Qe={key:5,class:"text-ink-gray-4"},Xe={key:0,class:"truncate flex items-center gap-2"},Ze={key:0},Ne={key:1},et={key:2},tt={key:3,class:"truncate text-base"},at={key:4,class:"truncate text-base max-h-44"},ot={key:5,class:"truncate text-base"},st={class:"flex gap-2 items-center justify-between"},lt={key:2,class:"flex h-full items-center justify-center"},nt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},Pt={__name:"Tasks",setup(g){const{getFormattedPercent:F,getFormattedFloat:E,getFormattedCurrency:w}=_e("CRM Task"),{getUser:R}=ue(),z=de(),B=M(null),r=M({}),A=M(1),T=M(1),v=M(20),n=M(null);function i(s,t){var e;function u(o){return o&&typeof o=="object"?o:{label:o}}return u((e=V.value)==null?void 0:e.find(o=>o.name==s)[t])}const V=I(()=>{var s,t,u,e;return(t=(s=r.value)==null?void 0:s.data)!=null&&t.data?r.value.data.view_type==="kanban"?c(r.value.data.data,r.value.data.fields):(le(),m((u=r.value)==null?void 0:u.data.data,(e=r.value)==null?void 0:e.data.columns)):[]});function c(s,t){let u=[];return s.forEach(e=>{var o;(o=e.data)==null||o.forEach(C=>{u.push(C)})}),m(u,t)}function m(s,t=[]){let u=r.value.data.view_type,e=u==="kanban"?"fieldname":"key",o=u==="kanban"?"fieldtype":"type";return s.map(C=>{var J;let L={};return(J=r.value)==null||J.data.rows.forEach(_=>{var G;L[_]=C[_];let x=(G=t==null?void 0:t.find(Q=>(Q[e]||Q.value)==_))==null?void 0:G[o];x&&["Date","Datetime"].includes(x)&&!["modified","creation","due_date"].includes(_)&&(L[_]=S(C[_],"",!0,x=="Datetime")),x&&x=="Currency"&&(L[_]=w(_,C)),x&&x=="Float"&&(L[_]=E(_,C)),x&&x=="Percent"&&(L[_]=F(_,C)),["modified","creation"].includes(_)?L[_]={label:S(C[_]),timeAgo:__(ke(C[_]))}:_=="assigned_to"&&(L[_]={label:C.assigned_to&&R(C.assigned_to).full_name,...C.assigned_to&&R(C.assigned_to)})}),L})}const p=M(!1),D=M({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function U(s){var u,e;let t=(u=V.value)==null?void 0:u.find(o=>o.name===s);D.value={name:t.name,title:t.title,description:t.description,assigned_to:((e=t.assigned_to)==null?void 0:e.email)||"",due_date:t.due_date,status:t.status,priority:t.priority,reference_doctype:t.reference_doctype,reference_docname:t.reference_docname},p.value=!0}function q(s){var t;if(D.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},(t=s.column)!=null&&t.name){let u=r.value.params.column_field;u&&(D.value[u]=s.column.name)}p.value=!0}function ae(s){return[{label:__("Delete"),icon:"trash-2",onClick:()=>{oe(s),r.value.reload()}}]}async function oe(s){await pe("frappe.client.delete",{doctype:"CRM Task",name:s})}function se(s,t){if(!t)return;let u=s=="CRM Deal"?"Deal":"Lead",e={leadId:t};u=="Deal"&&(e={dealId:t}),z.push({name:u,params:e})}const le=()=>{var u;const s=new URLSearchParams(window.location.search),t=s.get("open");t&&((u=V.value)!=null&&u.length)&&(U(parseInt(t)),s.delete("open"),window.history.replaceState(null,"",window.location.pathname))};return(s,t)=>{const u=W("Button");return a(),d(j,null,[l(ye,null,{"left-header":f(()=>[l(ce,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),routeName:"Tasks"},null,8,["modelValue"])]),"right-header":f(()=>{var e;return[(e=B.value)!=null&&e.customListActions?(a(),b(fe,{key:0,actions:B.value.customListActions},null,8,["actions"])):y("",!0),l(u,{variant:"solid",label:s.__("Create"),iconLeft:"plus",onClick:q},null,8,["label"])]}),_:1}),l(ge,{ref_key:"viewControls",ref:n,modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),loadMore:A.value,"onUpdate:loadMore":t[2]||(t[2]=e=>A.value=e),resizeColumn:T.value,"onUpdate:resizeColumn":t[3]||(t[3]=e=>T.value=e),updatedPageCount:v.value,"onUpdate:updatedPageCount":t[4]||(t[4]=e=>v.value=e),doctype:"CRM Task",options:{allowedViews:["list","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),s.$route.params.viewType=="kanban"&&V.value.length?(a(),b(Te,{key:0,modelValue:r.value,"onUpdate:modelValue":t[6]||(t[6]=e=>r.value=e),options:{onClick:e=>U(e.name),onNewClick:e=>q(e)},onUpdate:t[7]||(t[7]=e=>n.value.updateKanbanSettings(e)),onLoadMore:t[8]||(t[8]=e=>n.value.loadMoreKanban(e))},{title:f(({titleField:e,itemName:o})=>[h("div",Ye,[e==="status"?(a(),d("div",Ke,[l(Y,{status:i(o,e).label},null,8,["status"])])):e==="priority"?(a(),d("div",Oe,[l(K,{priority:i(o,e).label},null,8,["priority"])])):e==="assigned_to"?(a(),d("div",qe,[i(o,e).full_name?(a(),b(k(O),{key:0,class:"flex items-center",image:i(o,e).user_image,label:i(o,e).full_name,size:"sm"},null,8,["image","label"])):y("",!0)])):y("",!0),["modified","creation"].includes(e)?(a(),d("div",Je,[l(k(P),{text:i(o,e).label},{default:f(()=>[h("div",null,$(i(o,e).timeAgo),1)]),_:2},1032,["text"])])):i(o,e).label?(a(),d("div",Ge,$(i(o,e).label),1)):(a(),d("div",Qe,$(s.__("No Title")),1))])]),fields:f(({fieldName:e,itemName:o})=>[i(o,e).label?(a(),d("div",Xe,[e==="status"?(a(),d("div",Ze,[l(Y,{class:"size-3",status:i(o,e).label},null,8,["status"])])):e==="priority"?(a(),d("div",Ne,[l(K,{priority:i(o,e).label},null,8,["priority"])])):e==="assigned_to"?(a(),d("div",et,[i(o,e).full_name?(a(),b(k(O),{key:0,class:"flex items-center",image:i(o,e).user_image,label:i(o,e).full_name,size:"sm"},null,8,["image","label"])):y("",!0)])):y("",!0),["modified","creation"].includes(e)?(a(),d("div",tt,[l(k(P),{text:i(o,e).label},{default:f(()=>[h("div",null,$(i(o,e).timeAgo),1)]),_:2},1032,["text"])])):e=="description"?(a(),d("div",at,[i(o,e).label?(a(),b(k(Re),{key:0,content:i(o,e).label,editable:!1,"editor-class":"!prose-sm max-w-none focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):y("",!0)])):(a(),d("div",ot,$(i(o,e).label),1))])):y("",!0)]),actions:f(({itemName:e})=>[h("div",st,[h("div",null,[i(e,"reference_docname").label?(a(),b(u,{key:0,class:"-ml-2",variant:"ghost",size:"sm",label:i(e,"reference_doctype").label=="CRM Deal"?s.__("Deal"):s.__("Lead"),iconRight:me,onClick:H(o=>se(i(e,"reference_doctype").label,i(e,"reference_docname").label),["stop"])},null,8,["label","onClick"])):y("",!0)]),l(k(te),{class:"flex items-center gap-2",options:ae(e),variant:"ghost",onClick:t[5]||(t[5]=H(()=>{},["stop","prevent"]))},{default:f(()=>[l(u,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])])]),_:1},8,["modelValue","options"])):r.value.data&&V.value.length?(a(),b(He,{key:1,ref_key:"tasksListView",ref:B,modelValue:r.value.data.page_length_count,"onUpdate:modelValue":t[9]||(t[9]=e=>r.value.data.page_length_count=e),list:r.value,"onUpdate:list":t[10]||(t[10]=e=>r.value=e),rows:V.value,columns:r.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:r.value.data.row_count,totalCount:r.value.data.total_count},onLoadMore:t[11]||(t[11]=()=>A.value++),onColumnWidthUpdated:t[12]||(t[12]=()=>T.value++),onUpdatePageCount:t[13]||(t[13]=e=>v.value=e),onShowTask:U,onApplyFilter:t[14]||(t[14]=e=>n.value.applyFilter(e)),onApplyLikeFilter:t[15]||(t[15]=e=>n.value.applyLikeFilter(e)),onLikeDoc:t[16]||(t[16]=e=>n.value.likeDoc(e)),onSelectionsChanged:t[17]||(t[17]=e=>n.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):r.value.data?(a(),d("div",lt,[h("div",nt,[l(ve,{class:"h-10 w-10"}),h("span",null,$(s.__("No {0} Found",[s.__("Tasks")])),1),l(u,{label:s.__("Create"),iconLeft:"plus",onClick:t[18]||(t[18]=e=>p.value=!0)},null,8,["label"])])])):y("",!0),p.value?(a(),b(Ue,{key:3,modelValue:p.value,"onUpdate:modelValue":t[19]||(t[19]=e=>p.value=e),reloadTasks:r.value,"onUpdate:reloadTasks":t[20]||(t[20]=e=>r.value=e),task:D.value},null,8,["modelValue","reloadTasks","task"])):y("",!0)],64)}}};export{Pt as default};
//# sourceMappingURL=Tasks-9d7904fb.js.map
